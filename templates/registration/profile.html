{% extends "base-xo.html" %}

{% load compress %}
{% load static %}
{% load widget_tweaks %}
{% load i18n %}
{% load tz %}
{% load customer_extras %}

{% block title %}â€” {% trans 'Profile' %}{% endblock %}

{% block head %}
<!-- Custom styles for this template -->

{% compress css %}
  <link rel="stylesheet" type="text/x-scss" href="{% static 'assets/custom/scss/index.scss' %}" />
{% endcompress %}
{# <link rel="stylesheet" type="text/css" href="{% static 'assets/custom/css/profile.css' %}" /> #}
<link rel="stylesheet" type="text/css" href="{% static 'animate.css/animate.min.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'seiyria-bootstrap-slider/dist/css/bootstrap-slider.css' %}" />

<!-- The required Stripe lib -->
  <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
  <script src="{% static 'seiyria-bootstrap-slider/dist/bootstrap-slider.min.js' %}"></script>

  <script type="text/javascript">
    // This identifies your website in the createToken call below
    // Stripe.setPublishableKey('pk_test_kfcuJ26NVnCUweuNmZSNoCwD');
    Stripe.setPublishableKey("{{ stripe_key }}");

    var stripeResponseHandler = function(status, response) {
      var $form = $('#payment-form');

      if (response.error) {
        // Show the errors on the form
        console.log(response.error.message);
        $form.find('.payment-errors').text(response.error.message);
        $form.find('button').prop('disabled', false);
        $form.find('i.loading-icon').removeClass('fa fa-refresh fa-spin');
        $form.find('span.loading-text').addClass('hidden');
      } else {
        // token contains id, last4, and card type fa fa-spinner
        var token = response.id;
        console.log('Token received');
        // Insert the token into the form so it gets submitted to the server
        $form.append($('<input type="hidden" name="stripeToken" />').val(token));
        // and re-submit
        // $form.get(0).submit();
        $.ajax({
          url: "{% url 'change_stripe' %}",
          type: "POST",
          data: $form.serialize(),
          success: function(data) {
            if (data.success !== true){
              $.notify({
                message: data.message
              }, {
                type: 'danger'
              });
              $form.find('button').prop('disabled', false);
              $form.find('span.loading-text').addClass('hidden');
              $form.find('#submit-subs').html("{% trans 'Submit' %}");
              console.log(data);
            } else {
              console.log('Stripe ID changed');
              $form.find('button').prop('disabled', false);
              $form.find('i.loading-icon').removeClass('fa fa-refresh fa-spin');
              $form.find('#submit-subs').html("{% trans 'Submit' %}");
              $form.find('span.loading-text').addClass('hidden');
              $form.find('.payment-errors').text('');

              $.notify({
                message: "{% trans 'Card details updated.' %}"
              }, {
                type: 'success'
              });

              $('.form-stripe').val('');

              location.reload(true);
              // $form.get(0).submit();

              // window.location.replace("/get_started/thankyou.html");
            }
          },
        });

      }
    };
    jQuery(function($) {
      $('#payment-form').submit(function(e) {
        e.preventDefault();
        var $form = $(this);
        // Disable the submit button to prevent repeated clicks
        $form.find('.payment-errors').text('');
        $form.find('button').prop('disabled', true);
        $form.find('i.loading-icon').addClass('fa fa-refresh fa-spin');
        $form.find('span.loading-text').removeClass('hidden');
        Stripe.card.createToken($form, stripeResponseHandler);
        // Prevent the form from submitting with the default action
        return false;
      });
    });

    // $('#submit-subs').click(function(){
    //   $( ".loading-icon" ).addClass('glyphicon glyphicon-refresh glyphicon-refresh-animate').delay(2000).fadeOut(2000, function(){
    //       $( ".loading-icon" ).removeClass('glyphicon glyphicon-refresh glyphicon-refresh-animate');
    //   });
    // });

  </script>

{% endblock %}

{% block content %}

{# Start Page container #}
<div class="page-container">

  {% comment %}
  {# TODO #}
  <div id="notif-wrapper">
    <div class="notif-header">
      <p class="s-h1-bold">{% trans 'Notifications' %}</p>
      <div class="notif-badge">99</div>

      <i class="fa fa-bell fa-2x pull-right" aria-hidden="true"></i>
    </div>

    <div class="notif-body">
      <div class="notif-item success">
        <p class="notif-msg">
          {% blocktrans %}Your subscription's shipping date has been changed.{% endblocktrans %}
        </p>
        <p class="notif-time"><small>Jan 16, 2017</small></p>
      </div>
      <div class="notif-item success">
        <p class="notif-msg">
          {% blocktrans %}Your subscription's shipping date has been changed.{% endblocktrans %}
        </p>
        <p class="notif-time"><small>Jan 16, 2017</small></p>
      </div>
      <div class="notif-item success">
        <p class="notif-msg">
          {% blocktrans %}Your subscription's shipping date has been changed.{% endblocktrans %}
        </p>
        <p class="notif-time"><small>Jan 16, 2017</small></p>
      </div>
      <div class="notif-item success">
        <p class="notif-msg">
          {% blocktrans %}Your subscription's shipping date has been changed.{% endblocktrans %}
        </p>
        <p class="notif-time"><small>Jan 16, 2017</small></p>
      </div>
      <div class="notif-item success">
        <p class="notif-msg">
          {% blocktrans %}Your subscription's shipping date has been changed.{% endblocktrans %}
        </p>
        <p class="notif-time"><small>Jan 16, 2017</small></p>
      </div>
      <div class="notif-item success">
        <p class="notif-msg">
          {% blocktrans %}Your subscription's shipping date has been changed.{% endblocktrans %}
        </p>
        <p class="notif-time"><small>Jan 16, 2017</small></p>
      </div>
      <div class="notif-item success">
        <p class="notif-msg">
          {% blocktrans %}Your subscription's shipping date has been changed.{% endblocktrans %}
        </p>
        <p class="notif-time"><small>Jan 16, 2017</small></p>
      </div>
      <div class="notif-item success">
        <p class="notif-msg">
          {% blocktrans %}Your subscription's shipping date has been changed.{% endblocktrans %}
        </p>
        <p class="notif-time"><small>Jan 16, 2017</small></p>
      </div>
      <div class="notif-item success">
        <p class="notif-msg">
          {% blocktrans %}Your subscription's shipping date has been changed.{% endblocktrans %}
        </p>
        <p class="notif-time"><small>Jan 16, 2017</small></p>
      </div>
      <div class="notif-item success">
        <p class="notif-msg">
          {% blocktrans %}Your subscription's shipping date has been changed.{% endblocktrans %}
        </p>
        <p class="notif-time"><small>Jan 16, 2017</small></p>
      </div>

      <div class="notif-item danger">
        <p class="notif-msg">
          {% trans 'Sorry there was an error trying to update your subscription. Please try again later.' %}
        </p>
        <p class="notif-time"><small>Jan 13, 2017</small></p>
      </div>

    </div>
  </div>
  {% endcomment %}

  <!-- sidemenu-wrapper -->
  <div class="sidemenu">
    {# <p class="s-h1-bold">Main</p> #}

    <ul role="tablist" class="nav nav-pills nav-stacked">
      <li role="presentation"
          class="
            {% if not active_tab == 'active_one_offs' %}active{% endif %}
            sidemenu-underline s-h1">
        <a id="tab-page-dashboard" href="#page-dashboard"
          aria-controls="page-dashboard"
          role="tab"
          data-toggle="tab">
          <i class="fa fa-home s-h2" aria-hidden="true"></i> {% trans 'Dashboard' %}
        </a>
      </li>

      <li role="presentation" class="sidemenu-underline s-h1">
        <a id="tab-page-rewards" href="#page-rewards"
          aria-controls="page-rewards"
          role="tab"
          data-toggle="tab">
          <i class="fa fa-coffee s-h2" aria-hidden="true"></i> {% trans 'Rewards' %}
        </a>
      </li>

      <li role="presentation"
          class="
            {% if active_tab == 'active_one_offs' %}active{% endif %}
            sidemenu-underline s-h1">
        <a id="tab-page-preferences" href="#page-preferences"
          aria-controls="page-preferences"
          role="tab"
          data-toggle="tab">
          <i class="fa fa-cog s-h2" aria-hidden="true"></i> {% trans 'Orders' %}
        </a>
      </li>

      <li role="presentation" class="sidemenu-underline s-h1">
        <a id="tab-page-history" href="#page-history"
          aria-controls="page-history"
          role="tab"
          data-toggle="tab">
          <i class="fa fa-history s-h2" aria-hidden="true"></i> {% trans 'Shipping history' %}
        </a>
      </li>

      <li role="presentation" class="sidemenu-underline s-h1">
        <a id="tab-page-account" href="#page-account"
          aria-controls="page-account"
          role="tab"
          data-toggle="tab">
          <i class="fa fa-user s-h2" aria-hidden="true"></i> {% trans 'Account' %}
        </a>
      </li>

      <li role="presentation" class="sidemenu-underline s-h1">
        <a id="tab-page-giftcredits" href="#page-gift-credits"
          aria-controls="page-gift-credits"
          role="tab"
          data-toggle="tab">
          <i class="fa fa-gift s-h2" aria-hidden="true"></i> {% trans 'Gift Credits' %}
        </a>
      </li>
    </ul>
    <!-- /.sidemenu main nav -->

    <!-- side-menu coffee offer -->

    {% comment %}
    <p class="s-h1-bold">{% blocktrans %}Hook's Recommendation{% endblocktrans %}</p>
    {% with coffee=best_sellers.coffee month=best_sellers.month %}
      <div class="panel offer">
        <div class="panel-heading">
          <div class="flex-centered-row">
            <p class="s-h1">
              {# <span class="clr-me-p">{% trans 'New' %}</span> {% trans 'Limited' %} #}
              {# You might be interested in this #}
            </p>
          </div>
        </div>
        <div class="panel-body">
          <div class="panel-row panel-row-vertical">
            <h4 class="text-center">{{ coffee.name }}</h4>
            <p>{% blocktrans %}{{ month }}'s best seller{% endblocktrans %}</p>
          </div>

          <div class="panel-row">
            <a class="btn btn-primary-white btn-hc btn-hc-xs js-special-new-btn"
              data-coffee-id="{{ coffee.id }}"
              data-toggle="modal"
              data-target="#addNewOneOffBags">
              {% trans 'Get it now' %}
            </a>
          </div>
        </div>
      </div>
    {% endwith %}

    {% with coffee=best_sellers.coffee_pods month=best_sellers.month %}
      <div class="panel offer">
        <div class="panel-heading">
          <div class="flex-centered-row">
            <p class="s-h1">
              {# <span class="clr-me-p">{% trans 'New' %}</span> {% trans 'Limited' %} #}
              {# You might be interested in this #}
            </p>
          </div>
        </div>
        <div class="panel-body">
          <div class="panel-row panel-row-vertical">
            <h4 class="text-center">{{ coffee.name }}</h4>
            <p>{% blocktrans %}{{ month }}'s best seller{% endblocktrans %}</p>
            <p class="text-center">{% blocktrans %}Nespresso<span class="registered-sign"></span> compatible pods{% endblocktrans %}</p>
          </div>

          <div class="panel-row">
            <a class="btn btn-primary-white btn-hc btn-hc-xs js-special-new-btn"
              data-coffee-id="{{ coffee.id }}"
              data-toggle="modal"
              data-target="#addNewOneOffPods">
              {% trans 'Get it now' %}
            </a>
          </div>
        </div>
      </div>
    {% endwith %}
    {% endcomment %}


    <!-- side-menu other products offer -->
    {% for gear in gears_recommend %}
      {% if forloop.first %}
        <p class="s-h1-bold">{% trans "Hook's special buy!" %}</p>
      {% endif %}

      <div class="panel offer">
        <div class="panel-heading">
          <div class="flex-centered-row">
            <p class="s-h1">
              <span class="clr-me-p"></span> {% trans 'Gear' %}
            </p>
          </div>
        </div>

        <div class="panel-body">
          <div class="panel-row panel-row-vertical">
            <h4 class="text-center">{{ gear.name }}</h4>
          </div>

          <div class="panel-row">
            <img width="100%" src="{{ gear.images.first.image.url }}" alt="">
          </div>

          <div class="panel-row">
            {# FIXME: gears_machines ? should be used get_absolute_url instead #}

            <a class="btn btn-primary-white btn-hc btn-hc-xs"
              {% if gear.special == 'set' %}
                href="{% url 'shop-gift-set' %}#moreinfo-modal{{ gear.id }}"
              {% elif gear.essentials %}
                href="{% url 'gears_essentials' %}#ess__modal-id{{ gear.id }}"
              {% else %}
                href="{% url 'gears_machines' %}#ess__modal-id{{ gear.id }}"
              {% endif %}
            >
              {% trans 'Get it now' %}
            </a>
          </div>
        </div>
      </div>
    {% endfor %}

    <!-- /.sidemenu offers -->
  </div>
  <!-- sidemenu -->

  <!-- start page row -->
  <div class="content-pane">

    <!-- main content -->
    <div class="tab-content">

      <!-- page dashboard -->
      <div role="tabpanel"
          class="tab-pane
            {% if not active_tab == 'active_one_offs' %}active{% else %}fade{% endif %}
            "
          id="page-dashboard">
        <div class="row">

          <!-- .db-currentlydrinking -->
					<div id="db-currentlydrinking" class="content-box dashboard">
            <div class="panel">

              <div class="panel-header">
                <p class="s-h1-bold">
                {% if not is_worldwide %}
                  {% trans 'Active subscriptions' %}
                {% else %}
                  {% trans 'Orders' %}
                {% endif %}
                </p>
              </div>

              <div class="panel-list">

                {% for order in orders %}
                <div class="pl-item js-sub-{{ order.id }}">
                  <div class="pl-item-info">
                    <h4 class="js-coffee-name">{{ order.coffee.name }}</h4>
                    <p class="s-h1">{% trans 'Will be shipped on' %}</p>
                    <p>{{ order.shipping_date|date:"F d (l)" }}</p>
                    <p class="s-h1">{% trans 'Will be shipped to' %}</p>
                    <p class="js-curr-addr-name">{{ order.shipping_address.name }}</p>
                    {% if order.status == 'DE' %}
                      <p class="warning--order-declined">{% trans 'Oops, Your order is on hold due to a card payment error. Please update your billing details!' %}</p>
                    {% endif %}
                  </div>
                  <img class="pl-item-img js-coffee-img" src='{{ order.coffee.img.url }}' />
                </div>
                {% endfor %}

                {% for order in orders_pods %}
                <div class="pl-item js-sub-{{ order.id }}">
                  <div class="pl-item-info">
                    <h4 class="js-coffee-name">{{ order.coffee.name }}</h4>
                    <p class="s-h1">{% trans 'Will be shipped on' %}</p>
                    <p>{{ order.shipping_date|date:"F d (l)" }}</p>
                    <p class="s-h1">{% trans 'Will be shipped to' %}</p>
                    <p class="js-curr-addr-name">{{ order.shipping_address.name }}</p>
                    {% if order.status == 'DE' %}
                      <p class="warning--order-declined">{% trans 'Oops, Your order is on hold due to a card payment error. Please update your billing details!' %}</p>
                    {% endif %}
                  </div>
                  <img class="pl-item-img js-coffee-img" src='{{ order.coffee.img.url }}' />
                </div>
                {% endfor %}

                {% for order in orders_bottled %}
                <div class="pl-item js-sub-{{ order.id }}">
                  <div class="pl-item-info">
                    <h4 class="js-coffee-name">{{ order.coffee.name }}</h4>
                    <p class="s-h1">{% trans 'Will be shipped on' %}</p>
                    <p>{{ order.shipping_date|date:"F d (l)" }}</p>
                    <p class="s-h1">{% trans 'Will be shipped to' %}</p>
                    <p class="js-curr-addr-name">{{ order.shipping_address.name }}</p>
                    {% if order.status == 'DE' %}
                      <p class="warning--order-declined">{% trans 'Oops, Your order is on hold due to a card payment error. Please update your billing details!' %}</p>
                    {% endif %}
                  </div>
                  <img class="pl-item-img js-coffee-img" src='{{ order.coffee.img.url }}' />
                </div>
                {% endfor %}

              </div>

              <div class="panel-body">
                <div class="panel-row">
                  <a href="#" role="tab" class="tab-select" data-tab="page-preferences">
                    {% if not is_worldwide %}
                      {% trans 'See my subscriptions' %}
                    {% else %}
                      {% trans 'See my orders' %}
                    {% endif %}
                  </a>
                </div>
              </div>

            </div>
          </div>
          <!-- /.db-currentlydrinking -->

          {% if not is_worldwide %}
            <!-- db-referral -->
            <div id="referral__box" class="content-box dashboard">
              <div class="panel">

                <div class="panel-header">

                  <p>{% trans 'Refer your friends. Get Rewarded.' %}</p>
                </div>

                <div class="ref-header-about">
                  <p>Invite your friends, they get their first bag of coffee for $2. For each friend that signs up, <b>you get 50%</b> off your next order!</p>
                </div>

                <div class="panel-body no-padding">
                  <div class="the-code">{{ the_code }}</div>
                </div>

                <div class='input-group'>
                  <input type='text' class='form-control js-ref-link' value='{{ ref_link }}' />
                  <span class='input-group-btn'>
                    <button type='button' class='btn btn-default js-copy-btn' onclick='copy_to_clipboard()'>Copy link to clipboard</button>
                  </span>
                </div>

                <div class="ref-invite-ways">
                  <div class="ref-invite-ways-btns">

                    <button type="button" class="ref-btn ref-btn--fb-color js-fb-send-ref-link" data-reflink="{{ ref_link }}">
                      <span class='fa fa-facebook'></span>
                      Facebook
                    </button>

                    <button type="button" class="ref-btn ref-btn--email-color" data-toggle="modal" data-target="#modal-referral-email">
                      <span class='fa fa-envelope'></span>
                      Email
                    </button>

                    <a class="ref-btn ref-btn--twitter-color" href="https://twitter.com/intent/tweet?text=Try out this amazing coffee subscription service here! {{ ref_link }}" target="_blank">
                      <span class='fa fa-twitter'></span>
                      Twitter
                    </a>

                    <a
                      href="whatsapp://send"
                      data-text="hey I recently tried Hook Coffee - a coffee subscription service and it is really good. I thought you might like it. Sign up via this link {{ ref_link }} and get your first bag of coffee for just $2!"
                      data-href=" "
                      class="wa_btn wa_btn_m ref-btn"
                      style="display:none;"
                    >
                      Share
                    </a>

                  </div>
                </div>

              </div>
            </div>
            <!-- db-referral -->
          {% endif %}

          {% comment %}
          <div id="db-social" class="content-box dashboard">
            <div id="db-social-follow" class="panel">
              <div class="panel-body">

                <div class="row">
                  <div class="col-xs-12 col-sm-6">
                    <p class="s-h1">{% trans 'Followers' %}</p>
                    <p class="s-h6">148,493</p>
                  </div>

                  <div class="col-xs-12 col-sm-6">
                    <p class="s-h1">{% trans 'Following' %}</p>
                    <p class="s-h6">5,000</p>
                  </div>
                </div>
              </div>

              <div class="panel-body">
                <a class="btn btn-primary btn-hc btn-hc-sm"
                  data-toggle="modal"
                  data-target="#md-follow">
                  {% trans 'Find friends' %}
                </a>
              </div>
            </div>
            <!-- /.db-follow -->

            <div id="db-social-feed" class="panel">
              <div class="panel-header">
                <p class="s-h1-bold">
                  {% blocktrans %}
                    Friend's Brew Recipes
                  {% endblocktrans %}
                </p>
              </div>

              <div class="panel-list no-padding">
                <div class="pl-item">
                  <a class="feed-recipe" data-toggle="modal" data-target="#md-friend">
                    <div class="media">
                      <div class="media-left media-middle">
                        <img class="img-circle" src='' width="40" height="40" />
                      </div>
                      <div class="media-body">
                        <p class="time pull-right"><small>4h</small></p>
                        <p>
                          <strong>Faye Sit</strong> created a new brew recipe for
                          <strong>Kopi Sutra</strong>.
                        </p>
                      </div>
                    </div>
                  </a>
                </div>

                <div class="pl-item">
                  <a class="feed-recipe" data-toggle="modal" data-target="#md-friend">
                    <div class="media">
                      <div class="media-left media-middle">
                        <img class="img-circle" src='' width="40" height="40" />
                      </div>
                      <div class="media-body">
                        <p class="time pull-right"><small>1d</small></p>
                        <p>
                          <strong>Tim Tam</strong> created a new brew recipe for
                          <strong>Guji Liya</strong>.
                        </p>
                      </div>
                    </div>
                  </a>
                </div>

                <div class="pl-item">
                  <a class="feed-recipe" data-toggle="modal" data-target="#md-friend">
                    <div class="media">
                      <div class="media-left media-middle">
                        <img class="img-circle" src='' width="40" height="40" />
                      </div>
                      <div class="media-body">
                        <p class="time pull-right"><small>3d</small></p>
                        <p>
                          <strong>Tim Tam</strong> created a new brew recipe for
                          <strong>Peara Peara</strong>.
                        </p>
                      </div>
                    </div>
                  </a>
                </div>

              </div>
            </div>
            <!-- /.db-social-feed -->

          </div>
          <!-- /.db-social -->
          {% endcomment %}

        </div>
      </div>
      <!-- page dashboard -->


      <!-- page rewards -->
			<div role="tabpanel" class="tab-pane" id="page-rewards">
        <div class="row">

          <div class="content-box rewards">

            <div class="panel">
              <div class="panel-body">
                <div class="panel-row panel-row-spaced-between">
                  <p class="header">{% trans 'Rewards' %}</p>
                  <a class="header" download="REWARDS FAQ.pdf" target="_blank" href="/static/faq/rewards.pdf">{% trans 'Rewards FAQ' %}</a>
                </div>

                <div class="panel-row">
                  <p>
                    {% blocktrans with name=customer.first_name trimmed %}
                      Hi {{ name }}, thank you for giving back to our farmers! Now it's our turn to give back to you!
                    {% endblocktrans %}
                  </p>
                </div>

                <div class="panel-row">
                  <p>
                    {% blocktrans trimmed %}
                      You have <span class="clr-me-p"><u><big class="js-total-points-have">{{ points }}</big></u> beanie points</span> to redeem!
                    {% endblocktrans %}
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="content-box rewards js-rewards">
            <div class="panel">
              <div class="panel-body">
                <div class="panel-row panel-row-spaced-between">
                  <p class="header">
                    {% trans 'Which of this would you like to redeem?' %}
                  </p>
                </div>

                <div class="row reward-row">

                  <!-- Present next order -->
                  <div class="reward-col">
                    <div class="reward-box">
                      <div class="cb-info cb-header">
                        <h4>{{ free_bag_item.name }}</h4>
                        <p><u>{{ free_bag_item.points }}</u> {% trans 'beanie points' %}</p>
                      </div>

                      <div class="cb-img cb-img-contain"
                        style='background-image: url({{ free_bag_item.img.url }})'>
                      </div>

                      <div class="cb-info">
                        {% if points < free_bag_item.points %}
                          <p class="reward-remains">
                            <small>
                              {% trans 'You only need' %}
                              <span class="points-remain">
                                <span class="points-remain-val">
                                  {% subtract free_bag_item.points points %}
                                </span>
                                {% trans 'points' %}
                              </span>
                              {% trans 'to get a free' %} {{ free_bag_item.name }}!
                            </small>
                          </p>
                        {% else %}
                          <p class="reward-remains">
                            <small>
                              {% trans 'You redeem this item for' %}
                              <span class="points-remain">
                                {{ free_bag_item.points }}
                                <span class="points-remain-val"></span>
                                {% trans 'points' %}
                              </span>.
                            </small>
                          </p>
                        {% endif %}
                      </div>

                      <div class="cb-info cb-footer cb-text-center">
                        <form class="js-create-redem" method="POST" action="{% url 'create_redem' %}">
                          {% csrf_token %}
                          <input type="hidden" name="item" value="{{ free_bag_item.id }}"/>
                          <button type="submit"
                            class="btn btn-primary btn-hc btn-hc-sm"
                            data-free-bag="true"
                            data-points="{{ free_bag_item.points }}"
                            {% if points < free_bag_item.points or free %}
                              disabled
                            {% endif %}>
                            {% trans 'Redeem' %}
                          </button>
                        </form>
                      </div>

                    </div>
                  </div>
                  <!-- /Present next order -->

                  {% for item in redeem_items %}
                  <div class="reward-col">
                    <div class="reward-box js-reward-item">
                      <div class="cb-info cb-header">
                        <h4>{{ item.name }}</h4>
                        <p><u>{{ item.points }}</u> {% trans 'beanie points' %}</p>
                      </div>

                      <div class="cb-img cb-img-contain"
                        style='background-image: url({{ item.img.url }})'>
                      </div>

                      <div class="cb-info">
                        {% if points < item.points %}
                          <p class="reward-remains"><small>{% trans 'You only need' %} <span class="points-remain"><span class="points-remain-val">{% subtract item.points points %}</span> {% trans 'points' %}</span> {% trans 'to get a free' %} {{ item.name }}!</small></p>
                        {% else %}
                          <p class="reward-remains"><small>{% trans 'You redeem this item for' %} <span class="points-remain">{{ item.points }}<span class="points-remain-val"></span> {% trans 'points' %}</span>.</small></p>
                        {% endif %}
                      </div>

                      <div class="cb-info cb-footer cb-text-center">
                        <form class="js-create-redem" method="POST" action="{% url 'create_redem' %}">
                          {% csrf_token %}
                          <input type="hidden" name="item" value="{{ item.id }}"/>
                          <button type="submit"
                            class="btn btn-primary btn-hc btn-hc-sm"
                            data-points="{{ item.points }}"
                            {% if points < item.points %}
                              disabled
                            {% endif %}
                          >
                            {% trans 'Redeem' %}
                          </button>
                        </form>
                      </div>

                    </div>
                  </div>
                  {% endfor %}

                </div>

              </div>
            </div>
          </div>

          <div class="content-box rewards">
            <div class="panel">
              <div class="panel-body">
                <div class="row reward-summary">

                  <div class="col-md-6">
                    <p class="s-h2">{% trans 'Total Beanie Points Accumulated' %}</p>
                    <p class="s-h4 js-total-points-earned">{{ accumulated_points }}</p>
                    <img src="{% static 'images/accumulated.png' %}" />
                  </div>

                  <div class="col-md-6">
                    <p class="s-h2">{% trans 'Total Beanie Points Redeemed' %}</p>
                    <p class="s-h4 js-total-points-redemed">{{ redemed_points }}</p>
                    <img src="{% static 'images/redeemed.png' %}" />
                  </div>

                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
      <!-- page rewards -->

			<div role="tabpanel"
          class="tab-pane
            {% if active_tab == 'active_one_offs' %}active{% else %}fade{% endif %}
            "
          id="page-preferences">
        <div class="row">

          <div class="content-box preferences">
            <ul class="nav nav-tabs" role="tablist">

              {% if not is_worldwide %}
                <li role="presentation" class="
                {% if active_tab == 'active_subscriptions' %} active {% endif %}
                ">
                  <a href="#prefbags"
                    aria-controls="prefbags"
                    role="tab"
                    data-toggle="tab">
                    <p class="header">{% trans 'Bags Subscription' %}</p>
                  </a>
                </li>

                <li role="presentation" class="
                {% if active_tab == 'active_subscriptions_pods' %} active {% endif %}
                ">
                  <a href="#prefshots"
                    aria-controls="prefshots"
                    role="tab"
                    data-toggle="tab">
                    <p class="header">{% trans 'ShotPods Subscription' %}</p>
                  </a>
                </li>
              {% endif %}

              <li role="presentation" class="
              {% if active_tab == 'active_one_offs' or is_worldwide %} active {% endif %}
              ">
                <a href="#prefoneoff"
                  aria-controls="prefoneoff"
                  role="tab"
                  data-toggle="tab">
                  <p class="header"></p>
                    {% if not is_worldwide %}
                      {% trans 'One-off' %}
                    {% else %}
                      {% trans 'Orders' %}
                    {% endif %}
                  </p>
                </a>
              </li>
            </ul>


            <div id="prefs" class="tab-content">
              <div id="prefbags"
                class="tab-pane {% if active_tab == 'active_subscriptions' and not is_worldwide %} active {% endif %}"
                role="tabpanel">

                <div class="pref-title__subs">
                  <p class="s-h2-bold">{% trans 'Your subscriptions' %}</p>

                  <button class="btn btn-primary btn-hc btn-hc-xs js-add-new-sub-btn {% if not orders %}hide{% endif %}"
                    data-toggle="modal"
                    data-target="#addNewSubsBags">
                    {% trans 'Add a new subscription' %}
                  </button>
                </div>

                {% for order in orders %}
                <div class="js-curr-subscription js-sub-{{ order.id }}"
                  data-order-id="{{ order.id }}"
                  data-shipping-date="{{ order.shipping_date|date:'d/m/Y' }}"
                  data-next-shipping-date="{{ order.get_next_shipping_date|date:'d/m/Y' }}">
                  <div class="js-pref-content">
                    <div class="panel-group panel-coffee-sub js-coffee-panel" id="coffee-sub-id-{{ order.id }}">
                      <div class="panel">

                        <div class="panel-header">
                          <div>
                            <h3 class="js-coffee-name">{{ order.coffee.name }}</h3>
                            <table>
                              <tr class="trans-toggle">
                                <td>
                                  <p class="s-h1">{% trans 'Brew Method' %}</p>
                                </td>
                                <td><p>{{ order.brew }}</p></td>
                              </tr>
                              <tr class="trans-toggle">
                                <td>
                                  <p class="s-h1">{% trans 'Packaging' %}</p>
                                </td>
                                <td><p>{{ order.get_package_display }}</p></td>
                              </tr>

                              <tr>
                                <td><p class="s-h1">{% trans 'Price' %}</p></td>
                                <td>
                                  <p class="js-sub-price">
                                    {% if free %}
                                      {% trans 'FREE!' %}
                                    {% else %}
                                      S${{ order.amount }}
                                    {% endif %}
                                  </p>
                                </td>
                              </tr>
                              <tr class="resumed-div
                                {% if order.status != 'AC' %}
                                  hide
                                {% endif %}">
                                <td>
                                  <p class="s-h1">{% trans 'Will be shipped on' %}</p>
                                </td>
                                <td>
                                  <p class="js-sched-details-date">
                                    {{ order.shipping_date|date:"F, d (l)" }}
                                  </p>
                                </td>
                              </tr>
                              <tr>
                                <td>
                                  <p class="s-h1">{% trans 'Will be shipped to' %}</p>
                                </td>
                                <td>
                                  <p class="js-curr-addr-name">
                                    {{ order.shipping_address.name }}
                                  </p>
                                </td>
                              </tr>
                              <tr>
                                <td>
                                  <p class="s-h1">{% trans 'Subscription frequency' %}</p>
                                </td>
                                <td>
                                  <p class="">
                                    Every {{ order.interval }} days
                                  </p>
                                </td>
                              </tr>

                              {% if order.status == 'DE' %}
                                <tr>
                                  <td colspan="2">
                                    <p class="warning--order-declined">{% trans 'Oops, Your order is on hold due to a card payment error. Please update your billing details!' %}</p>
                                  </td>
                                </tr>
                              {% endif %}

                            </table>
                          </div>

                          <img class="coffeeimg trans-toggle js-coffee-img"
                            src='{{ order.coffee.img.url }}' />
                        </div>

                        <div class="panel-footer" role="tab" id="coffee-sub-id-{{ order.id }}">
                          <p class="s-h4">
                            <a role="button"
                              class="accordion accordion-main"
                              data-toggle="collapse"
                              data-parent="#coffee-sub-id-{{ order.id }}"
                              href="#collapse-coffee-sub-id-{{ order.id }}"
                              aria-expanded="true"
                              aria-controls="collapseOtherPrefs">
                              <i class="fa fa-caret-down" aria-hidden="true"></i>
                            </a>
                          </p>
                        </div>

                        <div id="collapse-coffee-sub-id-{{ order.id }}"
                          class="panel-collapse collapse"
                          role="tabpanel"
                          aria-labelledby="headingOtherPrefs">
                          <div class="panel-body">

                            <div class="panel-row">

                                <p class="header text-center">
                                  {% with hours=order.hours_to_change %}
                                    {% if order.is_editable and hours <= 48 %}
                                      {% blocktrans %}
                                        You have <span class="s-h4-lc">{{ hours }} hrs</span> left to make changes to this order.
                                      {% endblocktrans %}
                                    {% elif not order.is_editable %}
                                      {% trans 'You are unable to change this order as it is currently being processed.' %}
                                    {% endif %}
                                  {% endwith %}
                                </p>

                              <div class="pref-action">
                                <a class="btn btn-primary btn-block btn-rounded
                                  {% if order.is_editable and order.coffee.name != 'Taster pack' and order.status != 'DE'%}js-open-prefs{% else %}not-active{% endif %}"
                                  role="button"
                                  {% if not order.is_editable or order.coffee.name == 'Taster pack' or order.status == 'DE' %}
                                    disabled
                                  {% endif %}
                                >
                                    {% trans 'Bags preferences' %}
                                </a>
                              </div>
                              <div class="pref-action">
                                <a class="btn btn-primary btn-block
                                  {% if order.is_editable and order.coffee.name != 'Taster pack' and order.status != 'DE' %}js-change-order-coffee-btn{% else %}not-active{% endif %}"
                                  data-toggle="modal"
                                  data-order-id="{{ order.id }}"
                                  data-target="#chooseNewCoffeeBags"
                                  {% if not order.is_editable or order.coffee.name == 'Taster pack' or order.status == 'DE' %}
                                    disabled
                                  {% endif %}
                                >
                                  {% trans 'Change your coffee' %}
                                </a>
                              </div>
                            </div>

                            <!-- subs buttons -->
                            {% if order.status != "DE" %}
                            <div class="panel-row">
                              {% if not order.is_editable %}
                                <p class="header text-center">
                                  {% trans 'You are unable to change this order as it is currently being processed.' %}
                                </p>
                              {% endif %}

                              <div class="shipping-action">
                                <div class="form-group">
                                  <form class="js-change-schedule" method="POST" action="{% url 'change_order_schedule' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="order" value="{{ order.id }}"/>
                                    <input type="hidden" name="event" value="change-shipping-date-tmr"/>
                                    <input type="hidden" name="newDate" value="{{ shipping_tmr|date:'d/m/Y' }}"/>
                                    <button type="submit"
                                      class="btn btn-primary btn-block btn-rounded js-sub-btn js-ship-tomorrow-btn"
                                      {% if not order.is_editable or order.is_paused or not shipping_tmr  %}
                                        disabled
                                      {% endif %}
                                    >
                                      {% trans 'Ship tomorrow' %}
                                    </button>
                                  </form>
                                </div>
                              </div>
                              <div class="shipping-action">
                                <div class="form-group">
                                  <form class="js-change-schedule" method="POST" action="{% url 'change_order_schedule' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="order" value="{{ order.id }}"/>
                                    <input type="hidden" name="event" value="skip-next-delivery"/>
                                    <input type="hidden" name="newDate" value="{{ order.get_after_next_shipping_date|date:'d/m/Y' }}"/>
                                    <button type="submit"
                                      class="btn btn-primary btn-block btn-rounded js-sub-btn js-skip-next-delivery-btn"
                                      {% if not order.is_editable or order.is_paused %}
                                        disabled
                                      {% endif %}
                                    >
                                      {% trans 'Skip this delivery' %}
                                    </button>
                                  </form>
                                </div>
                              </div>
                              <div class="shipping-action">
                                <div class="form-group">
                                  <form class="js-change-schedule" method="POST" action="{% url 'change_order_schedule' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="order" value="{{ order.id }}"/>
                                    <input type="hidden" name="event" value="change-shipping-date"/>
                                    <input type="hidden" name="newDate" value=""/>
                                    <button type="button"
                                      class="btn btn-primary btn-block btn-rounded js-sub-btn js-change-schedule-btn"
                                      data-toggle="modal"
                                      data-target="#change-sched-modal"
                                      {% if not order.is_editable or order.is_paused %}
                                        disabled
                                      {% endif %}>
                                      {% trans 'Change shipping date' %}
                                    </button>
                                  </form>
                                </div>
                              </div>
                            </div>
                            {% endif %}
                            <!-- subs buttons end -->

                            <!-- subs shipping address -->
                            <div class="panel-row">
                              <div class="panel-group"
                                id="subs-addr-{{ order.id }}"
                                role="tablist"
                                aria-multiselectable="true">
                                <div class="header">
                                  {% trans 'Shipping Address' %}
                                  <a role="button"
                                    data-toggle="collapse"
                                    data-parent="#subs-addr-{{ order.id }}"
                                    href="#subs-addr-change-{{ order.id }}"
                                    aria-expanded="true"
                                    aria-controls="collapseOne">
                                    {% trans 'Change Address' %}
                                  </a>
                                </div>

                                {% with address=order.shipping_address %}
                                  <p class="selected-addr">
                                    <span class="addr-name">
                                      {{ address.name }}
                                    </span>
                                    <span class="addr">
                                      {{ address.line1 }} {{ address.line2 }},
                                      {{ address.country.name }} {{ address.postcode }}
                                    </span>
                                  </p>
                                {% endwith %}
                              </div>

                              <div id="subs-addr-change-{{ order.id }}"
                                class="panel-collapse collapse js-subs-addr-change"
                                role="tabpanel"
                                aria-labelledby="headingOne">
                                <ul class="address-list js-address-list">

                                  {% with address=order.shipping_address %}
                                  {% for form in addresses_forms %}
                                    <li data-subid="subs-addr-change"
                                      data-order-id="{{ order.id }}"
                                      data-parent-id="subs-addr-{{ order.id }}"
                                      data-addr-id="{{ form.initial.id }}"
                                      {% if address.id == form.initial.id %}
                                        class="selected"
                                      {% endif %}
                                      >
                                      <div>
                                        <p><b class="js-addr-name">{{ form.name.value }}</b></p>
                                        <p><small class="js-addr-recipient_name">{{ form.recipient_name.value }}</small></p>
                                        <p class="js-addr-lines">
                                          {{ form.line1.value }} {{ form.line2.value }},
                                          <br />
                                          {% firstof form.initial.country.name form.instance.country.name %}
                                          {{ form.postcode.value }}
                                        </p>
                                      </div>
                                      <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                                    </li>
                                  {% endfor %}
                                  {% endwith %}

                                </ul>

                                <div class="panel-row-footer">
                                  <a class="s-h1-bold js-subs-addr-change-cancel" role="button">
                                    {% trans 'Cancel' %}
                                  </a>
                                  <form class="js-change-order-address" method="POST" action="{% url 'change_order_address' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="order"/>
                                    <input type="hidden" name="address"/>
                                    <button type="submit" class="btn btn-primary"
                                      {% if not order.is_editable %}
                                        disabled
                                      {% endif %}>
                                      {% trans 'Save' %}
                                    </button>
                                  </form>
                                </div>
                              </div>
                            </div>
                            <!-- end subs shipping address -->

                            <div class="panel-row">
                              {% if order.status == 'PA' %}
                                <p class="header">
                                  {% trans 'Your subscription is temporarily paused. You may resume it any time.' %}
                                </p>
                              {% elif order.status == 'AC' %}
                                <p class="header">
                                  {% trans 'Have a voucher? Apply it now.' %}
                                </p>

                                <form method="POST" action="{% url 'profile_voucher' %}" class="js-submit-voucher">
                                  {% csrf_token %}
                                  <input type="hidden" name="order" value="{{ order.id }}" />
                                  <div class="form-group">
                                    <input id="voucher-input" class="form-control" name="voucher" type="text" size="32"
                                      {% if order.voucher %}
                                        placeholder="{{ order.voucher.name }}" disabled
                                      {% endif %}
                                    />
                                  </div>
                                  <button type="submit" class="btn btn-primary"
                                    {% if order.voucher %}
                                      disabled
                                    {% endif %}
                                  >
                                    {% trans 'Apply' %}
                                  </button>
                                  <span class="help-block hide"></span>
                                </form>
                              {% elif order.status == 'DE' %}
                                <div class="panel-row panel-row-spaced-between">
                                  <p class="header">{% trans 'Your order is pending.' %}</p>
                                </div>
                              {% endif %}
                            </div>

                            <!-- subs other opts -->
                            <div class="panel-row">
                              <div class="panel-group"
                                id="subs-other-opt-{{ order.id }}"
                                role="tablist"
                                aria-multiselectable="true">
                                <p class="header">
                                  <a role="button"
                                    data-toggle="collapse"
                                    href="#subs-other-opt-coll-{{ order.id }}"
                                    aria-expanded="true"
                                    aria-controls="collapseOne">
                                    {% trans 'Other subscription preferences' %}
                                  </a>
                                </p>
                              </div>

                              <div id="subs-other-opt-coll-{{ order.id }}"
                                class="panel-collapse collapse"
                                role="tabpanel">
                                {% if not order.is_editable %}
                                  <p class="header">
                                    {% trans 'You are unable to change this order as it is currently being processed.' %}
                                  </p>
                                {% endif %}
                                <p>
                                  <a class="{% if order.is_editable %}js-sub-pause{% else %}not-active{% endif %}"
                                    data-action="{% if order.is_paused %}resume{% else %}pause{% endif %}"
                                    data-order-id="{{ order.id }}"
                                    href="#"
                                  >
                                    {% if order.is_paused %}
                                      {% trans 'Resume' %}
                                    {% else %}
                                      {% trans 'Pause subscription for 30 days' %}
                                    {% endif %}
                                  </a>
                                </p>
                                <p>
                                  <a class="{% if order.is_editable and not order.is_paused %}js-show-unsubscribe-modal{% else %}not-active{% endif %}"
                                    data-order-id="{{ order.id }}"
                                    data-toggle="modal"
                                    data-target="#cancel-sub-modal"
                                    href="#">
                                    {% trans 'Unsubscribe' %}
                                  </a>
                                </p>
                              </div>
                            </div>
                            <!-- end subs other opts -->

                            <div class="panel-footer">
                              <p class="s-h4">
                                <a role="button"
                                  class="accordion"
                                  data-toggle="collapse"
                                  data-parent="#coffee-sub-id-{{ order.id }}"
                                  href="#collapse-coffee-sub-id-{{ order.id }}"
                                  aria-expanded="true"
                                  aria-controls="collapseOtherPrefs">
                                  <i class="fa fa-caret-down" aria-hidden="true"></i>
                                </a>
                              </p>
                            </div>

                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- /.js-pref-content -->

                  <div class="js-pref-prefs hide">
                    <!-- Preferences form -->
                    <div class="panel panel-form">
                      <div class="panel-header">
                        <p class="s-h2-bold">
                          {% trans 'Preferences' %}

                          <a type="button"
                            data-toggle="popover"
                            data-content="{% blocktrans %}Changes made here are only applied to the currently selected subscription. Each subscription has it's own set of preferences.{% endblocktrans %}">
                            <span class="glyphicon glyphicon-info-sign" aria-hidden="true">
                            </span>
                          </a>

                        </p>
                        <a class="js-close-prefs" href="#">{% trans 'Cancel' %}</a>
                      </div>

                      <div class="panel-body">

                        <!-- Form body -->
                        <div class="form-body">
                          <div class="form-container">
                            <form class="form-horizontal js-update-preferences" method="POST" action="{% url 'update_order' %}">
                              {% csrf_token %}

                              <div class="form-group">
                                <p class="header"><b>{% trans 'Brew method' %}</b></p>

                                <div class="form-option-list">
                                {% for brew in brew_methods %}
                                  <div data-value="{{ brew.id }}"
                                    class="form-option opt-brew pref-option
                                    {% if brew.id == order.brew.id %}
                                      selected
                                    {% endif %}
                                    {{ brew.name }}-opt"
                                  >
                                    <div class="form-option-wrapper">
                                      <div class="img-thumbnail"
                                        style="background-image: url({{ brew.img.url }})">
                                      </div>
                                      <p class="s-h1">{{ brew.name }}</p>
                                    </div>
                                  </div>
                                {% endfor %}
                                </div>
                              </div>

                              <div class="form-group">
                                <p class="header"><b>
                                  {% trans 'How do you want your coffee packaged?' %}
                                </b></p>

                                <div class="form-option-list">
                                  {% for key, value in preferences_form.package.field.choices %}
                                    <div data-value="{{ key }}"
                                    class="form-option opt-pack pref-option {% if key == order.package %}selected{% endif %} {{ key }}-opt">
                                      <div class="form-option-wrapper">
                                        <div class="img-thumbnail" style="background-image: url({% static 'images/package_methods/' %}{% if key == 'GR' %}ground{% elif key == 'WB' %}wholebeans{% elif key == 'DR' %}dripbag{% elif key == 'BB' %}brew_bags{% endif %}.png)"></div>
                                        <p class="s-h1">{{ value }}</p>
                                      </div>
                                    </div>
                                  {% endfor%}
                                </div>
                              </div>

                              <div class="form-group form-group-slider test_css">
                                <div class="col-xs-12">
                                  <p>Tell us how often youâ€™d like us to deliver your coffee </p>
                                    <br>
                                  <p class='custom_h1'>EVERY:</p>

                                  <div data-toggle="buttons" class="col-xs-12">
                                    <div class="row delivery_days">
                                        <div class="col-xs-4">
                                          <label id="weekly" data-value="7" class="btn col-xs-offset-1 col-sm-offset-4
                                            {% if order.interval == '7' %}
                                              active
                                            {% endif %}
                                                ">
                                              <input type="radio" class="hide">
                                              <p class='custom_h2'>7</p>
                                          </label>

                                          <p> days</p>
                                        </div>

                                        <div class="col-xs-4">
                                            <label id="fortnight" data-value="14" class="btn col-xs-offset-1 col-sm-offset-4
                                            {% if order.interval == '14' %}
                                              active
                                            {% endif %}
                                            ">
                                                <input type="radio" class="hide">
                                                <p class='custom_h2'>14</p>
                                            </label>

                                            <p> days</p>
                                        </div>

                                        <div class="col-xs-4">
                                            <label id="monthly" data-value="28" class="btn col-xs-offset-1 col-sm-offset-4
                                            {% if order.interval == '28' %}
                                              active
                                            {% endif %}
                                            ">
                                                <input type="radio" class="hide">
                                                <p class='custom_h2'>28</p>
                                            </label>

                                            <p> days</p>
                                        </div>
                                    </div>

                                      <br>
                                      <p>To help you estimate better, one cup of coffee a day works out to be<br>
                                          about 1 bag every 2 weeks</p>
                                      <br>

                                      <p>Donâ€™t worry! You are not locked into any frequency, you can change it <br>
                                        later on or order emergency bags on your account page.</p>
                                      <br>

                                      <div class="row">
                                          <div class="col-xs-12 col-sm-6 col-sm-offset-3 col-xs-offset-0">
                                            <label class="btn btn-default btn-hc-sm opt-diff col-xs-12 another_frequency
                                              {% if order.interval == '7' or order.interval == '14' or order.interval == '28' %}
                                                active
                                              {% endif %}
                                            " data-value=false>

                                            <input type="radio" class="hide"/>
                                              <p>Choose another frequency </p>
                                            </label>
                                          </div>
                                      </div>

                                      <div class="row frequency hide">
                                          <p class='custom_h1'>EVERY:</p>
                                      </div>

                                      <div class="row frequency hide">
                                          <div class="input-group col-sm-4 col-xs-12 col-xs-offset-0 col-sm-offset-4">
                                            <span class="input-group-btn">
                                              <button type="button" class="btn btn-default btn-number" data-type="minus" data-field="quant[1]">
                                                <span class="glyphicon glyphicon-minus"></span>
                                              </button>
                                            </span>
                                            <input type="text" name="quant[1]" class="form-control input-number" value="{{order.interval}}" min="4" max="40"/>
                                            <span class="input-group-btn">
                                              <button type="button" class="btn btn-default btn-number" data-type="plus" data-field="quant[1]">
                                                <span class="glyphicon glyphicon-plus"></span>
                                              </button>
                                            </span>
                                          </div>
                                      </div>

                                      <div class="row frequency hide">
                                        <p class='custom_h1'>DAYS</p>
                                      </div>

                                </div>
                                {% if not coffee.is_discovery_pack %}

                                    <div class="col-xs-12" style="padding-top:20px;">
                                      <div class="btn-group" data-toggle="buttons">
                                        <label id="same" class="btn btn-default btn-hc-sm opt-diff" data-value=false>
                                          <input type="radio" /> {% trans 'Same' %}
                                        </label>
                                        <label id="different" class="btn btn-default btn-hc-sm opt-diff active" data-value=true title="We will send you a random&#013;selection of coffees. However &#013;occasional we might send you the &#013;same thing, so do check back to &#013;change your coffee selection!">
                                          <input type="radio" /> {% trans 'Surprise me' %}
                                        </label>
                                      </div>
                                    </div>
                                {% endif %}
                              </div>
                          </div>

                              {% if not order.coffee.is_discovery_pack %}
                              <div class="form-group">
                                <p class="header">
                                  <b>{% trans "The coffee that's sent to you every time will be" %}</b>

                                  <a type="button"
                                    data-toggle="popover"
                                    data-content="{% blocktrans %}We will send you a random selection of coffees. However occasional we might send you the same thing, so do check back to change your coffee selection!{% endblocktrans %}">
                                    <span class="glyphicon glyphicon-info-sign" aria-hidden="true">
                                    </span>
                                  </a>
                                </p>

                                <div class="btn-group" data-toggle="buttons">
                                  {% with different=order.different %}
                                    <label class="btn btn-default btn-hc-sm {% if not different %}active{% endif %} pref-option opt-diff" data-value=false>
                                      <input type="radio" name="different" value="False" {% if not different %}checked{% endif %} /> {% trans 'Same' %}
                                    </label>
                                    <label class="btn btn-default btn-hc-sm {% if different %}active{% endif %} pref-option opt-diff" data-value=true>
                                      <input type="radio" name="different" value="True" {% if different %}checked{% endif %} /> {% trans 'Surprise me' %}
                                    </label>
                                  {% endwith %}
                                </div>
                              </div>
                              {% endif %}

                              <div class="form-group controls">
                                <input type="hidden" name="order" value="{{ order.id }}" />
                                {% for order_id, form in order_forms.items %}
                                  {% if order_id == order.id %}
                                    {{ form.brew.as_hidden }}
                                    {{ form.package.as_hidden }}
                                    {{ form.interval.as_hidden }}
                                  {% endif %}
                                {% endfor %}
                                <button type="submit" class="btn btn-primary">{% trans 'Save' %}</button>
                              </div>

                            </form>
                          </div>
                        </div>
                        <!-- /Form body -->

                        {# <div id="preferences-change-feedback" role="alert"></div> #}
                      </div>
                    </div>
                    <!-- Preferences form -->
                  </div>
                  <!--/ .js-pref-prefs -->
                </div>
                {% endfor %}

                <div class="js-no-subscription {% if orders %}hide{% endif %}">
                  <div class="text-center">
                    <h4 class="hc-text-noshadow" style="margin: 0; padding: 40px;">
                      {% blocktrans with name=customer.first_name trimmed %}
                        Hi {{ name }}, you currently do not have any bags subscription, would you like us to prepare one for you?
                      {% endblocktrans%}
                      {# <br><strong><span class="use-base-font">=)</span></strong> #}
                    </h4>
                    <a type="button" class="btn btn-primary btn-hc"
                      data-toggle="modal"
                      data-target="#addNewSubsBags">
                      {% trans 'Create a subscription here' %}
                    </a>
                  </div>
                </div>
              </div>
              <!-- /.prefbags -->

              <div id="prefshots"
                class="tab-pane {% if active_tab == 'active_subscriptions_pods' %} active {% endif %}"
                role="tabpanel">

                <div class="pref-title__subs">
                  <p class="s-h2-bold">{% trans 'Your subscriptions' %}</p>

                  <button class="btn btn-primary btn-hc btn-hc-xs js-add-new-sub-btn {% if not orders_pods %}hide{% endif %}"
                    data-toggle="modal"
                    data-target="#addNewSubsPods">
                    {% trans 'Add a new subscription' %}
                  </button>
                </div>

                {% for order in orders_pods %}
                <div class="js-curr-subscription js-sub-{{ order.id }}"
                  data-order-id="{{ order.id }}"
                  data-shipping-date="{{ order.shipping_date|date:'d/m/Y' }}"
                  data-next-shipping-date="{{ order.get_next_shipping_date|date:'d/m/Y' }}">
                  <div class="js-pref-content">
                    <div class="panel-group panel-coffee-sub js-coffee-panel" id="coffee-sub-id-{{ order.id }}">
                      <div class="panel">

                        <div class="panel-header">
                          <div>
                            <h3 class="js-coffee-name">{{ order.coffee.name }}</h3>
                            <table>
                              <tr>
                                <td><p class="s-h1">{% trans 'price' %}</p></td>
                                <td>
                                  <p class="js-sub-price">
                                    {% if free %}
                                      {% trans 'FREE!' %}
                                    {% else %}
                                      S${{ order.amount }}
                                    {% endif %}
                                  </p>
                                </td>
                              </tr>
                              <tr class="resumed-div
                                {% if order.status != 'AC' %}
                                  hide
                                {% endif %}">
                                <td>
                                  <p class="s-h1">{% trans 'Will be shipped on' %}</p>
                                </td>
                                <td>
                                  <p class="js-sched-details-date">
                                    {{ order.shipping_date|date:"F, d (l)" }}
                                  </p>
                                </td>
                              </tr>
                              <tr>
                                <td>
                                  <p class="s-h1">{% trans 'Will be shipped to' %}</p>
                                </td>
                                <td>
                                  <p class="js-curr-addr-name">
                                    {{ order.shipping_address.name }}
                                  </p>
                                </td>
                              </tr>
                              <tr>
                                <td>
                                  <p class="s-h1">{% trans 'Subscription frequency' %}</p>
                                </td>
                                <td>
                                  <p class="">
                                    Every {{ order.interval }} days
                                  </p>
                                </td>
                              </tr>
                              {% if order.status == 'DE' %}
                                <tr>
                                  <td colspan="2">
                                    <p class="warning--order-declined">{% trans 'Oops, Your order is on hold due to a card payment error. Please update your billing details!' %}</p>
                                  </td>
                                </tr>
                              {% endif %}
                            </table>
                          </div>

                          <img class="coffeeimg trans-toggle js-coffee-img"
                            src='{{ order.coffee.img.url }}' />
                        </div>

                        <div class="panel-footer" role="tab" id="coffee-sub-id-{{ order.id }}">
                          <p class="s-h4">
                            <a role="button"
                              class="accordion accordion-main"
                              data-toggle="collapse"
                              data-parent="#coffee-sub-id-{{ order.id }}"
                              href="#collapse-coffee-sub-id-{{ order.id }}"
                              aria-expanded="true"
                              aria-controls="collapseOtherPrefs">
                              <i class="fa fa-caret-down" aria-hidden="true"></i>
                            </a>
                          </p>
                        </div>

                        <div id="collapse-coffee-sub-id-{{ order.id }}"
                          class="panel-collapse collapse"
                          role="tabpanel"
                          aria-labelledby="headingOtherPrefs">
                          <div class="panel-body">

                            <div class="panel-row">

                                <p class="header text-center">
                                  {% with hours=order.hours_to_change %}
                                    {% if order.is_editable and hours <= 48 %}
                                      {% blocktrans %}
                                        You have <span class="s-h4-lc">{{ hours }} hrs</span> left to make changes to this order.
                                      {% endblocktrans %}
                                    {% elif not order.is_editable %}
                                      {% trans 'You are unable to change this order as it is currently being processed.' %}
                                    {% endif %}
                                  {% endwith %}
                                </p>

                              <div class="pref-action">
                                <a class="btn btn-primary btn-block btn-rounded
                                  {% if order.is_editable and order.coffee.name != 'Shotpods Taster Pack' and order.status != 'DE' %}js-open-prefs{% else %}not-active{% endif %}"
                                  role="button"
                                  {% if not order.is_editable or order.coffee.name == 'Shotpods Taster Pack' or order.status == 'DE' %}
                                    disabled
                                  {% endif %}
                                >
                                    {% trans 'ShotPods preferences' %}
                                </a>
                              </div>
                              <div class="pref-action">
                                <a class="btn btn-primary btn-block
                                  {% if order.is_editable and order.coffee.name != 'Shotpods Taster Pack' and order.status != 'DE' %}js-change-order-coffee-btn{% else %}not-active{% endif %}"
                                  data-toggle="modal"
                                  data-order-id="{{ order.id }}"
                                  data-target="#chooseNewCoffeePods"
                                  {% if not order.is_editable or order.coffee.name == 'Shotpods Taster Pack' or order.status == 'DE' %}
                                    disabled
                                  {% endif %}
                                >
                                  {% trans 'Change your coffee' %}
                                </a>
                              </div>
                            </div>

                            <!-- subs buttons -->
                            {% if order.status != "DE" %}
                            <div class="panel-row">
                              {% if not order.is_editable %}
                                <p class="header">
                                  {% trans 'You are unable to change this order as it is currently being processed.' %}
                                </p>
                              {% endif %}

                              <div class="shipping-action">
                                <div class="form-group">
                                  <form class="js-change-schedule" method="POST" action="{% url 'change_order_schedule' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="order" value="{{ order.id }}"/>
                                    <input type="hidden" name="event" value="change-shipping-date-tmr"/>
                                    <input type="hidden" name="newDate" value="{{ shipping_tmr|date:'d/m/Y' }}"/>
                                    <button type="submit"
                                      class="btn btn-primary btn-block btn-rounded js-sub-btn js-ship-tomorrow-btn"
                                      {% if not order.is_editable or order.is_paused or not shipping_tmr  %}
                                        disabled
                                      {% endif %}
                                    >
                                      {% trans 'Ship tomorrow' %}
                                    </button>
                                  </form>
                                </div>
                              </div>
                              <div class="shipping-action">
                                <div class="form-group">
                                  <form class="js-change-schedule" method="POST" action="{% url 'change_order_schedule' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="order" value="{{ order.id }}"/>
                                    <input type="hidden" name="event" value="skip-next-delivery"/>
                                    <input type="hidden" name="newDate" value="{{ order.get_after_next_shipping_date|date:'d/m/Y' }}"/>
                                    <button type="submit"
                                      class="btn btn-primary btn-block btn-rounded js-sub-btn js-skip-next-delivery-btn"
                                      {% if not order.is_editable or order.is_paused %}
                                        disabled
                                      {% endif %}
                                    >
                                      {% trans 'Skip this delivery' %}
                                    </button>
                                  </form>
                                </div>
                              </div>
                              <div class="shipping-action">
                                <div class="form-group">
                                  <form class="js-change-schedule" method="POST" action="{% url 'change_order_schedule' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="order" value="{{ order.id }}"/>
                                    <input type="hidden" name="event" value="change-shipping-date"/>
                                    <input type="hidden" name="newDate" value=""/>
                                    <button type="button"
                                      class="btn btn-primary btn-block btn-rounded js-sub-btn js-change-schedule-btn"
                                      data-toggle="modal"
                                      data-target="#change-sched-modal"
                                      {% if not order.is_editable or order.is_paused %}
                                        disabled
                                      {% endif %}>
                                      {% trans 'Change shipping date' %}
                                    </button>
                                  </form>
                                </div>
                              </div>
                            </div>
                            {% endif %}
                            <!-- subs buttons end -->

                            <!-- subs shipping address -->
                            <div class="panel-row">
                              <div class="panel-group"
                                id="subs-addr-{{ order.id }}"
                                role="tablist"
                                aria-multiselectable="true">
                                <div class="header col-xs-12">
                                  {% trans 'Shipping Address' %}
                                  <a role="button"
                                    data-toggle="collapse"
                                    data-parent="#subs-addr-{{ order.id }}"
                                    href="#subs-addr-change-{{ order.id }}"
                                    aria-expanded="true"
                                    aria-controls="collapseOne">
                                    {% trans 'Change Address' %}
                                  </a>
                                </div>

                                {% with address=order.shipping_address %}
                                  <p class="selected-addr">
                                    <span class="addr-name">
                                      {{ address.name }}
                                    </span>
                                    <span class="addr">
                                      {{ address.line1 }} {{ address.line2 }},
                                      {{ address.country.name }} {{ address.postcode }}
                                    </span>
                                  </p>
                                {% endwith %}
                              </div>

                              <div id="subs-addr-change-{{ order.id }}"
                                class="panel-collapse collapse js-subs-addr-change"
                                role="tabpanel"
                                aria-labelledby="headingOne">
                                <ul class="address-list js-address-list">

                                  {% with address=order.shipping_address %}
                                  {% for form in addresses_forms %}
                                    <li data-subid="subs-addr-change"
                                      data-order-id="{{ order.id }}"
                                      data-parent-id="subs-addr-{{ order.id }}"
                                      data-addr-id="{{ form.initial.id }}"
                                      {% if address.id == form.initial.id %}
                                        class="selected"
                                      {% endif %}
                                      >
                                      <div>
                                        <p><b class="js-addr-name">{{ form.name.value }}</b></p>
                                        <p><small class="js-addr-recipient_name">{{ form.recipient_name.value }}</small></p>
                                        <p class="js-addr-lines">
                                          {{ form.line1.value }} {{ form.line2.value }},
                                          <br />
                                          {% firstof form.initial.country.name form.instance.country.name %}
                                          {{ form.postcode.value }}
                                        </p>
                                      </div>
                                      <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                                    </li>
                                  {% endfor %}
                                  {% endwith %}

                                </ul>

                                <div class="panel-row-footer">
                                  <a class="s-h1-bold js-subs-addr-change-cancel" role="button">
                                    {% trans 'Cancel' %}
                                  </a>
                                  <form class="js-change-order-address" method="POST" action="{% url 'change_order_address' %}">
                                    {% csrf_token %}
                                    <input type="hidden" name="order"/>
                                    <input type="hidden" name="address"/>
                                    <button type="submit" class="btn btn-primary"
                                      {% if not order.is_editable %}
                                        disabled
                                      {% endif %}>
                                      {% trans 'Save' %}
                                    </button>
                                  </form>
                                </div>
                              </div>
                            </div>
                            <!-- end subs shipping address -->

                            <div class="panel-row">
                              {% if order.status == 'PA' %}
                                <p class="header">
                                  {% trans 'Your subscription is temporarily paused. You may resume it any time.' %}
                                </p>
                              {% elif order.status == 'AC' %}
                              <p class="header">
                                {% trans 'Have a voucher? Apply it now.' %}
                              </p>

                              <form method="POST" action="{% url 'profile_voucher' %}" class="js-submit-voucher">
                                {% csrf_token %}
                                <input type="hidden" name="order" value="{{ order.id }}" />
                                <div class="form-group">
                                  <input id="voucher-input" class="form-control" name="voucher" type="text" size="32"
                                    {% if order.voucher %}
                                      placeholder="{{ order.voucher.name }}" disabled
                                    {% endif %}
                                  />
                                </div>
                                <button type="submit" class="btn btn-primary"
                                  {% if order.voucher %}
                                    disabled
                                  {% endif %}
                                >
                                  {% trans 'Apply' %}
                                </button>
                                <span class="help-block hide"></span>
                              </form>
                              {% elif order.status == 'DE' %}
                              <div class="panel-row panel-row-spaced-between">
                                <p class="header">{% trans 'Your order is pending.' %}</p>
                              </div>
                              {% endif %}
                            </div>

                            <!-- subs other opts -->
                            <div class="panel-row">
                              <div class="panel-group"
                                id="subs-other-opt-{{ order.id }}"
                                role="tablist"
                                aria-multiselectable="true">
                                <p class="header">
                                  <a role="button"
                                    data-toggle="collapse"
                                    href="#subs-other-opt-coll-{{ order.id }}"
                                    aria-expanded="true"
                                    aria-controls="collapseOne">
                                    {% trans 'Other subscription preferences' %}
                                  </a>
                                </p>
                              </div>

                              <div id="subs-other-opt-coll-{{ order.id }}"
                                class="panel-collapse collapse"
                                role="tabpanel">
                                {% if not order.is_editable %}
                                  <p class="header">
                                    {% trans 'You are unable to change this order as it is currently being processed.' %}
                                  </p>
                                {% endif %}
                                <p>
                                  <a class="{% if order.is_editable %}js-sub-pause{% else %}not-active{% endif %}"
                                    data-action="{% if order.is_paused %}resume{% else %}pause{% endif %}"
                                    data-order-id="{{ order.id }}"
                                    href="#"
                                  >
                                    {% if order.is_paused %}
                                      {% trans 'Resume' %}
                                    {% else %}
                                      {% trans 'Pause subscription for 30 days' %}
                                    {% endif %}
                                  </a>
                                </p>
                                <p>
                                  <a class="{% if order.is_editable and not order.is_paused %}js-show-unsubscribe-modal{% else %}not-active{% endif %}"
                                    data-order-id="{{ order.id }}"
                                    data-toggle="modal"
                                    data-target="#cancel-sub-modal"
                                    href="#">
                                    {% trans 'Unsubscribe' %}
                                  </a>
                                </p>
                              </div>
                            </div>
                            <!-- end subs other opts -->

                            <div class="panel-footer">
                              <p class="s-h4">
                                <a role="button"
                                  class="accordion"
                                  data-toggle="collapse"
                                  data-parent="#coffee-sub-id-{{ order.id }}"
                                  href="#collapse-coffee-sub-id-{{ order.id }}"
                                  aria-expanded="true"
                                  aria-controls="collapseOtherPrefs">
                                  <i class="fa fa-caret-down" aria-hidden="true"></i>
                                </a>
                              </p>
                            </div>

                          </div>
                        </div>

                      </div>
                    </div>
                  </div>
                  <!-- /.js-pref-content -->

                  <div class="js-pref-prefs hide">
                    <!-- Preferences form -->
                    <div class="panel panel-form">
                      <div class="panel-header">
                        <p class="s-h2-bold">
                          {% trans 'Preferences' %}

                          <a type="button"
                            data-toggle="popover"
                            data-content="{% blocktrans %}Changes made here are only applied to the currently selected subscription. Each subscription has it's own set of preferences.{% endblocktrans %}">
                            <span class="glyphicon glyphicon-info-sign" aria-hidden="true">
                            </span>
                          </a>
                        </p>
                        <a class="js-close-prefs" href="#">{% trans 'Cancel' %}</a>
                      </div>

                      <div class="panel-body">

                        <!-- Form body -->
                        <div class="form-body">
                          <div class="form-container">
                            <form class="form-horizontal js-update-preferences" method="POST" action="{% url 'update_order' %}">
                              {% csrf_token %}

                              <div class="form-group form-group-slider test_css">
                                <div class="col-xs-12">
                                  <p>Tell us how often youâ€™d like us to deliver your coffee </p>
                                    <br>
                                  <p class='custom_h1'>EVERY:</p>

                                  <div data-toggle="buttons" class="col-xs-12">
                                    <div class="row delivery_days">
                                        <div class="col-xs-4">
                                          <label id="weekly" data-value="7" class="btn col-xs-offset-1 col-sm-offset-4">
                                              <input type="radio" class="hide">
                                              <p class='custom_h2'>7</p>
                                          </label>

                                          <p> days</p>
                                        </div>

                                        <div class="col-xs-4">
                                            <label id="fortnight" data-value="14" class="btn col-xs-offset-1 col-sm-offset-4">
                                                <input type="radio" class="hide">
                                                <p class='custom_h2'>14</p>
                                            </label>

                                            <p> days</p>
                                        </div>

                                        <div class="col-xs-4">
                                            <label id="monthly" data-value="28" class="btn col-xs-offset-1 col-sm-offset-4">
                                                <input type="radio" class="hide">
                                                <p class='custom_h2'>28</p>
                                            </label>

                                            <p> days</p>
                                        </div>
                                    </div>

                                      <br>
                                      <p>To help you estimate better, one cup of coffee a day works out to be<br>
                                          about 1 bag every 2 weeks</p>
                                      <br>

                                      <p>Donâ€™t worry! You are not locked into any frequency, you can change it <br>
                                        later on or order emergency bags on your account page.</p>
                                      <br>

                                      <div class="row">
                                          <div class="col-xs-12 col-sm-6 col-sm-offset-3 col-xs-offset-0">
                                            <label  class="btn btn-default btn-hc-sm opt-diff col-xs-12 another_frequency" data-value=false>
                                            <input type="radio" class="hide"/>
                                              <p>Choose another frequency </p>
                                            </label>
                                          </div>
                                      </div>

                                      <div class="row frequency hide">
                                          <p class='custom_h1'>EVERY:</p>
                                      </div>

                                      <div class="row frequency hide">
                                          <div class="input-group col-sm-4 col-xs-12 col-xs-offset-0 col-sm-offset-4">
                                            <span class="input-group-btn">
                                              <button type="button" class="btn btn-default btn-number" data-type="minus" data-field="quant[1]">
                                                <span class="glyphicon glyphicon-minus"></span>
                                              </button>
                                            </span>
                                            <input type="text" name="quant[1]" class="form-control input-number" value="25" min="4" max="40" readonly="readonly" />
                                            <span class="input-group-btn">
                                              <button type="button" class="btn btn-default btn-number" data-type="plus" data-field="quant[1]">
                                                <span class="glyphicon glyphicon-plus"></span>
                                              </button>
                                            </span>
                                          </div>
                                      </div>

                                      <div class="row frequency hide">
                                        <p class='custom_h1'>DAYS</p>
                                      </div>

                                    </div>
                                    {% if not coffee.is_discovery_pack %}

                                        <div class="col-xs-12" style="padding-top:20px;">
                                          <div class="btn-group" data-toggle="buttons">
                                            <label id="same" class="btn btn-default btn-hc-sm opt-diff" data-value=false>
                                              <input type="radio" /> {% trans 'Same' %}
                                            </label>
                                            <label id="different" class="btn btn-default btn-hc-sm opt-diff active" data-value=true title="We will send you a random&#013;selection of coffees. However &#013;occasional we might send you the &#013;same thing, so do check back to &#013;change your coffee selection!">
                                              <input type="radio" /> {% trans 'Surprise me' %}
                                            </label>
                                          </div>
                                        </div>
                                    {% endif %}
                                  </div>
                              </div>

                              {% if not order.coffee.is_discovery_pack %}
                              <div class="form-group">
                                <p class="header">
                                  <b>
                                    {% trans "The coffee that's sent to you every time will be" %}
                                  </b>

                                  <a type="button"
                                    data-toggle="popover"
                                    data-content="{% blocktrans %}We will send you a random selection of coffees. However occasional we might send you the same thing, so do check back to change your coffee selection!{% endblocktrans %}">
                                    <span class="glyphicon glyphicon-info-sign" aria-hidden="true">
                                    </span>
                                  </a>
                                </p>

                                <div class="btn-group" data-toggle="buttons">
                                  {% with different=order.different %}
                                    <label class="btn btn-default btn-hc-sm {% if not different %}active{% endif %} pref-option opt-diff" data-value=false>
                                      <input type="radio" name="different" value="False" {% if not different %}checked{% endif %} /> {% trans 'Same' %}
                                    </label>
                                    <label class="btn btn-default btn-hc-sm {% if different %}active{% endif %} pref-option opt-diff" data-value=true>
                                      <input type="radio" name="different" value="True" {% if different %}checked{% endif %} /> {% trans 'Surprise me' %}
                                    </label>
                                  {% endwith %}
                                </div>
                              </div>
                              {% endif %}

                              <div class="form-group controls">
                                <input type="hidden" name="order" value="{{ order.id }}" />
                                {% for order_id, form in order_forms.items %}
                                  {% if order_id == order.id %}
                                    {{ form.interval.as_hidden }}
                                  {% endif %}
                                {% endfor %}
                                <button type="submit" class="btn btn-primary">{% trans 'Save' %}</button>
                              </div>

                            </form>
                          </div>
                        </div>
                        <!-- /Form body -->

                      </div>
                      <!-- Preferences form -->
                    </div>
                    <!-- Preferences Pods (Nespresso) -->
                  </div>
                  <!--/ .js-pref-prefs -->
                </div>
                {% endfor %}

                <div class="js-no-subscription {% if orders_pods %}hide{% endif %}">
                  <div class="text-center">
                    <h4 class="hc-text-noshadow" style="margin: 0; padding: 40px;">
                      {% blocktrans with name=customer.first_name trimmed %}
                        Hi {{ name }}, you currently do not have any pods subscription, would you like us to prepare one for you?
                      {% endblocktrans%}
                      {# <br><strong><span class="use-base-font">=)</span></strong> #}
                    </h4>
                    <a type="button" class="btn btn-primary btn-hc"
                      data-toggle="modal"
                      data-target="#addNewSubsPods">
                      {% trans 'Create a subscription here' %}
                    </a>
                  </div>
                </div>
              </div>
              <!-- /.pref-shots -->

              {% include 'registration/includes/order list (bottled).html' %}

              <!-- one-off / A La Carte -->
              <div id="prefoneoff"
                class="tab-pane {% if active_tab == 'active_one_offs' or is_worldwide %} active {% endif %}"
                role="tabpanel">

                {% if alacartes %}
                  <div class="panel js-curr-subscription">
                    <div class="table-responsive">
                      <table class="table table-hover">
                        <thead>
                          <tr>
                            <th><p class="s-h1-bold">{% trans 'Shipping Date' %}</p></th>
                            <th><p class="s-h1-bold">{% trans 'Shipping Address' %}</p></th>
                            <th><p class="s-h1-bold">{% trans 'Coffee' %}</p></th>
                            <th><p class="s-h1-bold">{% trans 'Brew Method' %}</p></th>
                            <th><p class="s-h1-bold">{% trans 'Package' %}</p></th>
                            <th><p class="s-h1-bold">{% trans 'Price' %}</p></th>
                            {# <th></th> #}
                          </tr>
                        </thead>
                        <tbody>
                          {% for i in alacartes %}
                            <tr id="order-{{ i.id }}">
                              {% if i.status == "AC" %}
                                <td>{{ i.shipping_date|date:"F, d" }}</td>
                              {% else %}
                                <td>{% trans 'Pending' %}</td>
                              {% endif %}
                              <td>{{ i.shipping_address.name }}</td>
                              <td>{{ i.coffee.name }} {{ i.coffee.maker }}</td>
                              <td>{{ i.brew }}</td>
                              <td>
                                {% if i.brew.name == "Nespresso" %}
                                  {% trans 'Pods' %}
                                {% else %}
                                  {% if i.coffee.name == "Discovery Programme" %}
                                    {% if i.package == "WB" %}
                                      {% trans 'Ground (3 x 80g)' %}
                                    {% elif i.package == "GR" %}
                                      {% trans 'Wholebeans (3 x 80g)' %}
                                    {% else %}
                                      {% trans 'Drip bags (3 x 4)' %}
                                    {% endif %}
                                  {% else %}
                                    {{ i.get_package_display }}
                                  {% endif %}
                                {% endif %}
                              </td>
                              <td>S${{ i.amount }}</td>
                              {% comment %}
                              <td>
                                <a class="btn btn-primary btn-hc btn-hc-xs js-cancel-one-off"
                                  data-isgear="false"
                                  data-order="{{ i.id }}"
                                  {% if not i.is_editable or is_worldwide %}
                                    disabled
                                  {% endif %}
                                >
                                  {% trans 'Cancel' %}
                                </a>
                              </td>
                              {% endcomment %}
                            </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>
                {% endif %}

                {% if gear_orders %}
                  <div class="col-xs-12">
                    <div class="panel panel-default">
                      <div class="panel-body">
                        <table class="table table-resposive">
                          <thead>
                            <tr>
                              <th><p class="s-h1-bold">{% trans 'Shipping date' %}</p></th>
                              <th><p class="s-h1-bold">{% trans 'Shipping Address' %}</p></th>
                              <th><p class="s-h1-bold">{% trans 'Name' %}</p></th>
                              <th><p class="s-h1-bold">{% trans 'Price' %}</p></th>
                              {# <th></th> #}
                            </tr>
                          </thead>
                          <tbody>
                            {% for i in gear_orders %}
                              <tr id="order-{{ i.id }}">
                                {% if i.status == "AC" %}
                                <td>{{ i.shipping_date|date:"F, d" }}</td>
                                {% else %}
                                <td>{% trans 'Pending' %}</td>
                                {% endif %}
                                <td>{{ i.shipping_address.name }}</td>
                                <td>{{ i.gear.name }}
                                      {% if i.details.Quantity > 1 %}
                                        [{% trans 'Qty' %}: {{ i.details.Quantity }}]
                                      {% endif %}
                                </td>
                                <td>{{ i.price }} SGD</td>
                                {% comment %}
                                <td>
                                  <a class="btn btn-primary btn-hc btn-hc-xs js-cancel-one-off"
                                    data-isgear="true"
                                    data-order="{{ i.id }}"
                                    {% if not i.is_editable or is_worldwide %}
                                      disabled
                                    {% endif %}
                                  >
                                    {% trans 'Cancel' %}
                                  </a>
                                </td>
                                {% endcomment %}
                              </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                {% endif %}
                {% if workshop_orders %}
                  <div class="col-xs-12">
                    <div class="panel panel-default">
                      <div class="panel-body">
                        <table class="table table-resposive">
                          <thead>
                            <tr>
                              <th><p class="s-h1-bold">{% trans 'WorkShop Name' %}</p></th>
                              <th><p class="s-h1-bold">{% trans 'Scheduled Date' %}</p></th>
                              <th><p class="s-h1-bold">{% trans 'Count' %}</p></th>
                              <th><p class="s-h1-bold">{% trans 'duration' %}</p></th>
                              <th><p class="s-h1-bold">{% trans 'Price' %}</p></th>
                              {# <th></th> #}
                            </tr>
                          </thead>
                          <tbody>
                            {% for i in workshop_orders %}
                              <tr id="order-{{ i.id }}">
                                <td>{{ i.workshop.name }}</td>
                                <td>{{ i.scheduled_date|date:"F, d" }}</td>
                                <td>{{ i.count }}</td>
                                <td>{{ i.workshop.duration }} Day(s)</td>
                                <td>{{ i.price }} SGD</td>
                                {% comment %}
                                <td>
                                  <a class="btn btn-primary btn-hc btn-hc-xs js-cancel-one-off"
                                    data-isgear="true"
                                    data-order="{{ i.id }}"
                                    {% if not i.is_editable or is_worldwide %}
                                      disabled
                                    {% endif %}
                                  >
                                    {% trans 'Cancel' %}
                                  </a>
                                </td>
                                {% endcomment %}
                              </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                {% endif %}


                {# No A La Carte #}
                <div class="js-no-subscription {% if alacartes or gear_orders or workshop_orders %}hide{% endif %}">
                  <div class="text-center">
                    <h4 style="margin: 0; padding: 40px;">
                      {% trans 'You dont have any one-off order yet' %}
                      <br />
                      <strong><span class="use-base-font">=)</span></strong>
                    </h4>
                    <a type="button" class="btn btn-primary btn-hc"
                      href="{% url 'coffees' %}">
                      {% trans 'Choose your first coffee' %}
                    </a>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- /.page-preferences -->

      <div role="tabpanel" class="tab-pane" id="page-account">
        <div class="row">
          <div class="content-box account">
            <ul class="nav nav-tabs" role="tablist">
              <li role="presentation" class="active">
                <a data-toggle="tab" href="#Account">
                  {% trans 'Account' %}
                </a>
              </li>
              <li role="presentation">
                <a data-toggle="tab" href="#Billing">
                  {% trans 'Billing' %}
                </a>
              </li>
            </ul>

            <div class="tab-content">
              <!-- Start of Tab ACCOUNT -->
              <div id="Account" class="tab-pane fade in active">
                <!-- Start of CARD FOR ACCOUNT -->
                <div class="panel panel-default">

                  <form class="js-update-profile" method="POST" action="{% url 'update_customer_details' %}">
                    {% csrf_token %}

                    <div class="panel-body">
                      <!--Start of ROW-->
                      <div class='panel-row panel-row-spaced-between'>
                        <p>{% trans 'Update your details' %}</p>
                      </div>
                      <!--End of ROW-->

                      <!--Start of ROW-->
                      <div class='row'>
                        <div class="col-md-6">
                          <div class="form-group form-group--first_name">
                            {{ customer_details_form.first_name.label_tag }}
                            {% render_field customer_details_form.first_name class+="form-control" %}
                            <span class="help-block"></span>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="form-group form-group--last_name">
                            {{ customer_details_form.last_name.label_tag }}
                            {% render_field customer_details_form.last_name class+="form-control" %}
                            <span class="help-block"></span>
                          </div>
                        </div>
                      </div>
                      <!--End of ROW-->

                      <!--Start of ROW-->
                      <div class='row'>
                        <div class="col-md-6">
                          <div class="form-group form-group--phone">
                            {{ customer_details_form.phone.label_tag }}&nbsp;
                            <small>{{ customer_details_form.phone.help_text }}</small>
                            {% render_field customer_details_form.phone class+="form-control" %}
                            <span class="help-block"></span>
                          </div>
                        </div>
                      </div>
                      <!--End of ROW-->

                    </div>

                    <div class="panel-footer">
                      <div class='flex-end-row'>
                        <button type="submit" class="btn btn-primary">
                          {% trans 'Save Details' %}
                        </button>
                      </div>
                    </div>

                  </form>

                </div>
                <!-- End of CARD FOR ACCOUNT-->

                <!-- Start of SHIPPING ADDRESS-->
                <div class="panel-group"
                  id="acct-addr"
                  role="tablist"
                  aria-multiselectable="true">
                  <div class="panel panel-default">
                    <div class="panel-header">
                      <div class="panel-row">
                        <p>{% trans 'Saved addresses' %}</p>
                      </div>

                      <div class="panel-row trans-toggle">
                        {% for form in addresses_forms %}
                          {% if form.is_primary.value %}
                            <p class="js-primary-addr">
                              {{ form.line1.value }} {{ form.line2.value }},
                              <br />
                              {% firstof form.initial.country.name form.instance.country.name %}
                              {{ form.postcode.value }}
                            </p>
                            <a role="button"
                              data-toggle="collapse"
                              data-parent="#acct-addr"
                              href="#acct-addr-change"
                              aria-expanded="true"
                              aria-controls="collapseOne"
                            >
                              {% trans 'Change Address' %}
                            </a>
                          {% endif %}
                        {% endfor %}
                      </div>

                      <div class="panel-row trans-toggle">
                        <a role="button"
                          data-toggle="collapse"
                          data-parent="#acct-addr"
                          href="#acct-addr-add"
                          aria-expanded="true"
                          aria-controls="collapseOne"
                        >
                          {% trans 'Add an address' %}
                        </a>
                      </div>
                    </div>

                    <!-- change address -->
                    <div id="acct-addr-change"
                      class="panel-collapse collapse"
                      role="tabpanel"
                      aria-labelledby="headingOne">
                      <div class="panel-body">
                        <div class="panel-row panel-row-default">
                          <ul class="address-list js-address-list">

                            {% for form in addresses_forms %}
                              <li data-subid="acct-addr-change"
                                data-addr-id="{{ form.initial.id }}"
                                {% if form.is_primary.value %}
                                  class="selected"
                                {% endif %}
                              >
                                <div>
                                  <p><b class="js-addr-name">{{ form.name.value }}</b></p>
                                  <p><small class="js-addr-recipient_name">{{ form.recipient_name.value }}</small></p>
                                  <p class="js-addr-lines">
                                    {{ form.line1.value }} {{ form.line2.value }},
                                    <br />
                                    {% firstof form.initial.country.name form.instance.country.name %}
                                    {{ form.postcode.value }}
                                  </p>
                                </div>
                                <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                              </li>
                            {% endfor %}

                          </ul>
                        </div>

                      </div>

                      <div class="panel-heading flex-spaced-between">
                        <a class="s-h1-bold" role="button" id="acct-addr-change-cancel">
                          {% trans 'Cancel' %}
                        </a>

                        <div>
                          <form class="form-inline js-delete-address"  style="display: inline-block;" method="POST" action="{% url 'delete_address' %}">
                            {% csrf_token %}
                            <input type="hidden" name="address"/>
                            <button type="submit" id="acct-addr-change-delete" class="btn btn-danger">
                              {% trans 'Delete' %}
                            </button>
                          </form>
                          <form class="form-inline js-change-primary-address" style="display: inline-block;" method="POST" action="{% url 'change_primary_address' %}">
                            {% csrf_token %}
                            <button type="button" id="acct-addr-change-edit" class="btn btn-primary">
                              {% trans 'Edit' %}
                            </button>
                            <input type="hidden" name="address"/>
                            <button type="submit" class="btn btn-primary">
                              {% trans 'Save' %}
                            </button>
                          </form>
                        </div>
                      </div>
                    </div>
                    <!-- change address -->

                    <!-- add address -->
                    <div id="acct-addr-add"
                      class="panel-collapse collapse"
                      role="tabpanel"
                      aria-labelledby="headingOne">

                      {% with form=new_address_form %}
                        <form class="js-update-address" method="POST" action="{% url 'create_address' %}">
                          {% csrf_token %}
                          <div class="panel-body">
                            <p class="s-h1-bold">{% trans 'Add address' %}</p>

                            <div class="form-group form-group--name">
                              {{ form.name.label_tag }}
                              {% render_field form.name class+="form-control" %}
                              <span class="help-block"></span>
                            </div>

                            <div class="form-group form-group--recipient_name">
                              <label for="{{ form.recipient_name.id_for_label }}">{% trans 'Full name' %}</label>
                              {% render_field form.recipient_name class+="form-control" %}
                              <span class="help-block"></span>
                            </div>

                            <div class="row">
                              <div class="col-md-6">
                                <div class="form-group form-group--line1">
                                  {{ form.line1.label_tag }}
                                  {% render_field form.line1 class+="form-control" %}
                                  <span class="help-block"></span>
                                </div>
                              </div>

                              <div class="col-md-6">
                                <div class="form-group form-group--line2">
                                  {{ form.line2.label_tag }}
                                  {% render_field form.line2 class+="form-control" %}
                                  <span class="help-block"></span>
                                </div>
                              </div>
                            </div>

                            <div class="row">
                              <div class="col-md-6">
                                <div class="form-group form-group--postcode">
                                  {{ form.postcode.label_tag }}
                                  {% render_field form.postcode class+="form-control" %}
                                  <span class="help-block"></span>
                                </div>
                              </div>
                            </div>

                            <div class="panel-row-footer flex-spaced-between">
                              <a class="s-h1-bold" role="button" id="acct-addr-add-cancel">
                                {% trans 'Cancel' %}
                              </a>

                              <button type="submit" class="btn btn-primary">
                                {% trans 'Add Address' %}
                              </button>
                            </div>
                          </div>
                        </form>
                      {% endwith %}

                    </div>
                    <!-- add address -->

                    {% for form in addresses_forms %}
                      <!-- edit address -->
                      <div class="panel-collapse collapse js-acct-addr-edit"
                        data-addr="{{ form.initial.id }}"
                        role="tabpanel"
                        aria-labelledby="headingOne">

                        <form class="js-update-address" method="POST" action="{% url 'update_address' %}">
                          {% csrf_token %}
                          <div class="panel-body">
                            <p class="s-h1-bold">{% trans 'Edit address' %}</p>

                            <div class="form-group form-group--name">
                              {{ form.name.label_tag }}
                              {% if form.name.value == 'Base address' %}
                                {% render_field form.name class+="form-control" disabled="disabled" %}
                              {% else %}
                                {% render_field form.name class+="form-control" %}
                              {% endif %}
                              <span class="help-block"></span>
                            </div>

                            <div class="form-group form-group--recipient_name">
                              <label for="{{ form.recipient_name.id_for_label }}">{% trans 'Full name' %}</label>
                              {% if form.name.value == 'Base address' %}
                                {% render_field form.recipient_name class+="form-control" disabled="disabled" %}
                              {% else %}
                                {% render_field form.recipient_name class+="form-control" %}
                              {% endif %}
                              <span class="help-block"></span>
                            </div>

                            <div class="row">
                              <div class="col-md-6">
                                <div class="form-group form-group--line1">
                                  {{ form.line1.label_tag }}
                                  {% render_field form.line1 class+="form-control" %}
                                  <span class="help-block"></span>
                                </div>
                              </div>

                              <div class="col-md-6">
                                <div class="form-group form-group--line2">
                                  {{ form.line2.label_tag }}
                                  {% render_field form.line2 class+="form-control" %}
                                  <span class="help-block"></span>
                                </div>
                              </div>
                            </div>

                            <div class="row">
                              <div class="col-md-6">
                                <div class="form-group form-group--postcode">
                                  {{ form.postcode.label_tag }}
                                  {% render_field form.postcode class+="form-control" %}
                                  <span class="help-block"></span>
                                </div>
                              </div>
                            </div>

                            <div class="panel-row-footer flex-spaced-between">
                              <a class="s-h1-bold js-acct-addr-edit-cancel" role="button">
                                {% trans 'Cancel' %}
                              </a>

                              <input type="hidden" name="address"
                                value="{{ form.initial.id }}"
                              />
                              <button type="submit" class="btn btn-primary">
                                {% trans 'Edit Address' %}
                              </button>
                            </div>
                          </div>
                        </form>

                      </div>
                      <!-- edit address -->
                    {% endfor %}

                  </div>
                </div>
                <!-- Start of SHIPPING ADDRESS-->


                <!-- Start of CARD FOR EMAIL & PASSWORD -->
                <div class="panel panel-default">
                  <div class="panel-body">
                    <div class='panel-row panel-row-spaced-between'>
                      <p class="header">
                        {% trans 'Your Email & Password' %}
                      </p>
                    </div>

                    <div class='row'>
                      <div class="col-md-12">
                        <p class="pull-left">{{ customer.get_email }}</p>
                        {% comment %}
                        <!-- Need time to implement this function -->
                        <a class="pull-right"
                          data-toggle="modal"
                          data-target="#changeEmail">
                          {% trans 'Change Email...' %}
                        </a>
                        {% endcomment %}
                      </div>
                    </div>
                  </div>

                  <div class="panel-footer">
                    <a role="button"
                      data-toggle="modal"
                      data-target="#changePassword">
                      {% trans 'Change Password' %}
                    </a>
                  </div>

                </div>
                <!-- End of CARD FOR EMAIL & PASSWORD -->
              </div>
              <!-- End of TAB ACCOUNT -->

              <!-- Start of TAB BILLING -->
              <div id="Billing" class="tab-pane fade">
                <!-- Start of CARD FOR CHANGE CARD -->
                <div id="panel1" class='collapse.in'>
                  <div class="panel panel-default">
                    <div class="panel-body">
                      <div class='panel-row panel-row-spaced-between'>
                        <p class="header">
                          {% trans 'Update your card details' %}
                        </p>

                        <a href="#" class="header" data-toggle="collapse" data-target="#panel2" aria-expanded="false" aria-controls="panel2">
                          {% trans 'Change Card...' %}
                        </a>
                      </div>

                      <div class="panel-row panel-row-vertical align-left">
                        <p class="header">.... .... .... {{ last4 }}</p>
                        <p class="header">{{ exp_month }}/{{ exp_year }}</p>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- End of CARD FOR CHANGE CARD -->

                <!-- Start of CARD UPDATE CARD DETAILS  -->
                <div id="panel2" class='collapse'>
                  <div class="panel panel-default">
                    <form id="payment-form" method="POST" action="">
                      {% csrf_token %}

                      <div class="panel-body">
                        <div class="panel-row panel-row-spaced-between">
                          <p class="header">{% trans 'Update your card details' %}</p>

                          <img height="30" src="{% static 'images/powered_by_stripe.png' %}" alt="Stripe" />
                        </div>

                        <div class="form-group has-error">
                          <p class="payment-errors"></p>
                        </div>

                        <div class="form-group">
                          <label for="userCardNumberField">
                            {% trans 'Card Number' %}
                          </label>
                          <input type="text" size="20" data-stripe="number" class="form-control form-stripe" placeholder="xxxx xxxx xxxx {{ last4 }}" />
                        </div>

                        <div class="other-card-info">
                          <div class="form-group">
                            <label for="userCardCVCField">{% trans 'CVC' %}</label>
                            <input id="userCardCVCField" type="text" class="form-control form-stripe" data-stripe="cvc" aria-describedby="emailHelp" placeholder="***"/>
                          </div>

                          <div class="form-group">
                            <label for="userCardExp">
                              {% trans 'Expiration (MM/YYYY)' %}
                            </label>
                            <div class="form-inline">
                              <input id="userCardExpireMonthField"
                                type="text"
                                class="form-control form-stripe"
                                data-stripe="exp-month"
                                aria-describedby="emailHelp"
                                placeholder="{{ exp_month }}"/>
                              <b> / </b>
                              <input id="userCardExpireYearField"
                                type="text"
                                class="form-control form-stripe"
                                data-stripe="exp-year"
                                placeholder="{{ exp_year }}"/>
                            </div>
                          </div>
                        </div>

                        <div class="form-group">
                          <span class="loading-text hidden">
                            {% trans "Verifying... Don't close your browser..." %}
                          </span>
                        </div>

                      </div>

                      <div class="panel-footer">
                        <div class="flex-spaced-between">
                          <a data-toggle="collapse"
                            data-target="#panel2"
                            aria-expanded="false"
                            aria-controls="panel2">
                            Cancel
                          </a>
                          <div class="form-group">
                            <input type="hidden" name="submit-payment"/>
                            <span class="loading-text hidden">Updating card details</span>
                            <button type=submit id="submit-subs" class="btn btn-primary btn-rounded subs-btn"><span><i class ="loading-icon"></i></span> Save Details </button>
                          </div>
                        </div>
                      </div>

                      <div id="profile-change-feedback" role="alert">
                      </div>
                      <div id="ccard-change-feedback" role="alert">
                      </div>

                    </form>

                  </div>
                </div>
                <!-- End of CARD FOR UPDATE CARD DETAILS -->
              </div>
              <!-- End of TAB BILLING -->
            </div>
          </div>
        </div>
      </div>
      <!-- /.page-account -->

      <div role="tabpanel" class="tab-pane" id="page-history">
        <div class="row">

          <div class="content-box history">
            <p class="page-title single header active">
              {% trans 'Shipping history' %}
            </h2>

            <div class="panel js-tb-responsive js-tb-share">

              <!-- Order history -->
              {% for i in history %}

                {% if i.coffee.is_discovery_pack %}

                  {% for coffee in i.discovery_coffees %}
                    <div class="history-box">
                      <div class="cb-img" style="background-image: url({{ coffee.img.url }})"></div>
                      <div class="cb-info">
                        <div class="cb-info-row">
                          <p class="s-h3">{{ coffee.name }}</p>

                          <p>
                            <span class="s-h1">{% trans 'Shipped on' %}</span>
                            <span class="s-h1-bold">
                              {{ i.shipping_date|date:"SHORT_DATE_FORMAT" }}
                            </span>
                          </p>
                        </div>

                        <div class="cb-info-row">
                          <a class="btn js-order-details" role="button" href="#"
                            data-toggle="modal"
                            data-target="#md-orderdetails"
                            data-order-id="{{ i.id }}"
                            data-order-status="{{ i.get_status_display }}"
                            data-order-rating="{{ coffee.review.rating }}"
                            data-order-review="{{ coffee.review.comment }}"
                            data-coffee-id="{{ coffee.id }}"
                            data-name="{{ coffee.name }}"
                            data-image="{{ coffee.img.url }}"
                            data-price="{{ i.amount|floatformat:2 }}"
                            data-subscription="{{ i.recurrent|yesno:'true,false' }}"
                            data-brew="{{ i.brew.name }}"
                            data-package="{{ i.get_package_display }}"
                            data-tracking=""
                            data-shipping-date="{{ i.shipping_date|date:'SHORT_DATE_FORMAT' }}"
                            data-estimate-delivery="{% get_estimated_date i.shipping_date %}"
                            {% with address=i.shipped_to %}
                            data-shipping-addr="
                              {{ address.line1 }} {{ address.line2 }},
                              <br />
                              {{ address.country }} {{ address.postcode }}"
                            {% endwith %}>
                            <span class="s-h1">{% trans 'See order details' %}</span>
                          </a>

                          {# TODO #}
                          <button class="btn btn-primary btn-hc btn-hc-xs js-show-order-review-modal"
                            data-order-id="{{ i.id }}"
                            data-order-rating="{{ coffee.review.rating }}"
                            data-order-review="{{ coffee.review.comment }}"
                            data-coffee-id="{{ coffee.id }}"
                            data-coffee-name="{{ coffee.name }}"
                            data-toggle="modal"
                            data-target="#md-orderreview">
                            {% trans 'Review' %}
                          </button>
                          {% comment %}
                          <button class="btn btn-primary btn-hc btn-hc-xs"
                            data-toggle="modal" data-target="#md-brewrecipe">
                            {% trans 'My Brew Recipe' %}
                          {% endcomment %}
                          </button>
                        </div>
                      </div>
                    </div>
                  {% endfor %}

                {% else %}

                  {% with review=i.reviews.get %}
                    <div class="history-box">
                      <div class="cb-img" style="background-image: url({{ i.coffee.img.url }})"></div>
                      <div class="cb-info">
                        <div class="cb-info-row">
                          <p class="s-h3">{{ i.coffee.name }}</p>

                          <p>
                            <span class="s-h1">{% trans 'Shipped on' %}</span>
                            <span class="s-h1-bold">
                              {{ i.shipping_date|date:"SHORT_DATE_FORMAT" }}
                            </span>
                          </p>
                        </div>

                        <div class="cb-info-row">
                          <a class="btn js-order-details" role="button" href="#"
                            data-toggle="modal"
                            data-target="#md-orderdetails"
                            data-order-id="{{ i.id }}"
                            data-order-status="{{ i.get_status_display }}"
                            data-order-rating="{{ review.rating }}"
                            data-order-review="{{ review.comment }}"
                            data-coffee-id="{{ i.coffee.id }}"
                            data-name="{{ i.coffee.name }}"
                            data-image="{{ i.coffee.img.url }}"
                            data-price="{{ i.amount|floatformat:2 }}"
                            data-subscription="{{ i.recurrent|yesno:'true,false' }}"
                            data-brew="{{ i.brew.name }}"
                            data-package="{{ i.get_package_display }}"
                            data-tracking=""
                            data-shipping-date="{{ i.shipping_date|date:'SHORT_DATE_FORMAT' }}"
                            data-estimate-delivery="{% get_estimated_date i.shipping_date %}"
                            {% with address=i.shipped_to %}
                            data-shipping-addr="
                              {{ address.line1 }} {{ address.line2 }},
                              <br />
                              {{ address.country }} {{ address.postcode }}"
                            {% endwith %}>
                            <span class="s-h1">{% trans 'See order details' %}</span>
                          </a>

                          {# TODO #}
                          <button class="btn btn-primary btn-hc btn-hc-xs js-show-order-review-modal"
                            data-order-id="{{ i.id }}"
                            data-order-rating="{{ review.rating }}"
                            data-order-review="{{ review.comment }}"
                            data-coffee-id="{{ i.coffee.id }}"
                            data-coffee-name="{{ i.coffee.name }}"
                            data-toggle="modal"
                            data-target="#md-orderreview">
                            {% trans 'Review' %}
                          </button>
                          {% comment %}
                          <button class="btn btn-primary btn-hc btn-hc-xs"
                            data-toggle="modal" data-target="#md-brewrecipe">
                            {% trans 'My Brew Recipe' %}
                          {% endcomment %}
                          </button>
                        </div>
                      </div>
                    </div>
                  {% endwith %}

                {% endif %}

              {% endfor %}
              <!-- /Order history -->


              <!-- Gear Orders history -->
              {% for i in gear_history %}
                <div class="history-box">
                  <div class="cb-img cb-img--special"
                    {% if i.gear.images %}
                      style="background-image: url({{ i.gear.images.first.image.url }})"
                    {% endif %}
                  >
                  </div>

                  <div class="cb-info">
                    <div class="cb-info-row">
                      <p class="s-h3">{{ i.gear.name }}</p>

                      <p>
                        <span class="s-h1">{% trans 'Shipped on' %}</span>
                        <span class="s-h1-bold">
                          {{ i.shipping_date|date:"SHORT_DATE_FORMAT" }}
                        </span>
                      </p>
                    </div>

                    <div class="cb-info-row">
                      <a class="btn js-order-details" role="button" href="#"
                        data-toggle="modal"
                        data-target="#md-orderdetails"
                        data-order-id="{{ i.id }}"
                        data-order-status="{{ i.get_status_display }}"
                        {# data-gear-id="{{ i.coffee.id }}" #}
                        data-name="{{ i.gear.name }}"
                        data-image="{{ i.gear.images.first.image.url }}"
                        data-price="{{ i.price|floatformat:2 }}"
                        data-subscription="false"
                        data-brew="{{ i.details.brew_method }}"
                        data-package="{{ i.details.packaging }}"
                        data-tracking="{{ i.tracking_number }}"
                        data-shipping-date="{{ i.shipping_date|date:'SHORT_DATE_FORMAT' }}"
                        {% with address=i.shipped_to %}
                        data-shipping-addr="
                          {{ address.line1 }} {{ address.line2 }},
                          <br />
                          {{ address.country }} {{ address.postcode }}"
                        {% endwith %}>
                        <span class="s-h1">{% trans 'See order details' %}</span>
                      </a>

                      {% comment %}
                      {# TODO #}
                      <button class="btn btn-primary btn-hc btn-hc-xs"
                        data-toggle="modal" data-target="#md-orderreview">
                        {% trans 'Review' %}
                      </button>

                      <button class="btn btn-primary btn-hc btn-hc-xs"
                        data-toggle="modal" data-target="#md-brewrecipe">
                        {% trans 'My Brew Recipe' %}
                      </button>
                      {% endcomment %}
                    </div>
                  </div>

                </div>
              {% endfor %}
              <!-- /Gear Orders history -->


              <!-- Redemption history -->
              {% for i in redemption_history %}
                <div class="history-box">
                  <div class="cb-img cb-img--special"
                    {% if i.item.img %}
                      style="background-image: url({{ i.item.img.url }})"
                    {% endif %}
                  >
                  </div>

                  <div class="cb-info">
                    <div class="cb-info-row">
                      <p class="s-h3">{{ i.item.name }}</p>

                      <p>
                        {% if i.status == 'done' %}
                          <span class="s-h1">{% trans 'Shipped on' %}</span>
                          <span class="s-h1-bold">{{ i.shipping_date|date:"SHORT_DATE_FORMAT" }}</span>
                        {% else %}
                          <span class="s-h1">{% trans 'Pending' %}</span>
                        {% endif %}
                      </p>
                    </div>

                    <div class="cb-info-row">
                      <a class="btn js-order-details" role="button" href="#"
                        data-toggle="modal"
                        data-target="#md-orderdetails"
                        data-name="{{ i.item.name }}"
                        {% if i.item.img %}
                          data-image="{{ i.item.img.url }}"
                        {% endif %}
                        data-order-status="{{ i.get_status_display }}"
                        data-points="{% firstof i.points '0' %}"
                        data-subscription="false"
                        data-tracking=""
                        data-shipping-date="{{ i.shipping_date|date:'SHORT_DATE_FORMAT' }}"
                        data-shipping-addr="
                          {{ customer.line1 }} {{ customer.line2 }},
                          <br />
                          {{ customer.country.name }} {{ customer.postcode }}">
                        <span class="s-h1">{% trans 'See order details' %}</span>
                      </a>

                      {% comment %}
                      {# TODO #}
                      <button class="btn btn-primary btn-hc btn-hc-xs"
                        data-toggle="modal" data-target="#md-orderreview">
                        {% trans 'Review' %}
                      </button>

                      <button class="btn btn-primary btn-hc btn-hc-xs"
                        data-toggle="modal" data-target="#md-brewrecipe">
                        {% trans 'My Brew Recipe' %}
                      </button>
                      {% endcomment %}
                    </div>
                  </div>

                </div>
              {% endfor %}
              <!-- /Redemption history -->

            </div>
          </div>

        </div>
      </div>
      <!-- /.page-history -->

			<!-- Gift Credits -->
			<div id="page-gift-credits" class="tab-pane fade">
        <div class="row">
          <div class="content-box gift-credits">
            <div class="pref-title__subs">
              <p class="s-h2-bold">{% trans 'Gift Credits' %}</p>
            </div>

            <div class="text-center">
              {% if customer.amount != 0 %}
                <h2 class="hc-text-noshadow" style="padding: 40px;">
                  {% blocktrans with amount=customer.amount trimmed %}
                  YOU HAVE <b>${{ amount }}</b> WORTH OF GIFT CREDITS REMAINING!
                  {% endblocktrans %}
                </h2>
                <a type="button" class="btn btn-primary btn-hc" href="{% url 'coffees' %}">
                  {% trans 'Choose Your Coffees' %}
                </a>
              {% else %}
                <h2 class="hc-text-noshadow" style="padding: 20px;">{% trans 'YOU ARE OUT OF GIFT CREDITS' %}</h2>
                <h4 class="hc-text-noshadow" style="padding: 40px;">{% trans 'Get started on a subscription to continue receiving a constant stream of freshly roasted coffee delivered to you' %}</h4>
                </br>
                <a type="button" class="btn btn-primary btn-hc" href="{% url 'coffees' %}">{% trans 'Get started' %}</a>
              {% endif %}
            </div>
          </div>
        </div>
			</div>
			<!-- Gift Credits -->


    </div>
    <!-- end main content -->

  </div>
  <!-- end page row -->

</div>
{# End Page container #}


{# All dashboard modals #}

<!-- Change sched sub modal -->
<div id="change-sched-modal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title text-center">{% trans 'Change Schedule' %}</h4>
      </div>
      <div class="modal-body">
        <div style="overflow:hidden;">
          <div class="form-group">
            <div class="row">
              <div class="col-xs-12">
                <div class="datepicker-wrapper text-center">
                  <div id="change-sched-date-picker" class="date-picker"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">{% trans 'Close' %}</button>
        <button type="button" class="btn btn-danger js-change-schedule-submit">{% trans 'Save changes' %}</button>
      </div>
    </div>
  </div>
</div>
<!-- /Change sched sub modal -->

<!-- Cancel sub modal -->
<div id="cancel-sub-modal" class="modal modal-hc fade cancel-sub-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header text-center">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <p>{% trans 'Unsubscribe' %}</p>
      </div>

      <div class="modal-body">
        <div class="modal-body-section__sm">
          <p class="t-h3-bold">
            {% blocktrans with first_name=customer.first_name trimmed %}
            Hi {{ first_name }}, it is sad to see you leave.
            {% endblocktrans %}
          </p>
          <p>{% trans 'No hard feelings, but just want to find out some reasons!' %}</p>

          <p class="t-h3-bold">
            {% trans 'You donâ€™t drink enough coffee for a subscription service?' %}
          </p>
          <p>{% trans 'We currently have a one-off purchase feature! which allows you to grab a bag of coffee whenever you wish!' %}</p>

          <p class="t-h3-bold">
            {% trans 'You do not like the coffee that have been sent to you?' %}
          </p>
          <p>{% trans 'Why not take a look at our other coffees?' %}</p>
          <a href="{% url 'coffees' %}" class="t-h3-s">
            {% trans 'Take a look at different coffees we offer' %}
          </a>

          <p class="t-h3-bold">
            {% trans 'You are going away and need a break from coffee?' %}
          </p>
          <p class="t-h3">
            <a href="#" class="js-skip-next-delivery-modal t-h3-s" data-order-id="">
              {% trans 'Skip this delivery' %}
            </a>
            {% trans 'or' %}
            <a href="#" class="js-sub-pause t-h3-s" data-order-id="" data-action="pause">
              {% trans 'pause your subscription for 30 days' %}
            </a>!
          </p>

          <p class="t-h3-bold">{% trans 'Any other queries!' %}</p>
          <p>
            {% trans 'Please feel free to drop us an email at' %}
            <a href="mailto:hola@hookcoffee.com.sg" class="clr-me-s">
              hola@hookcoffee.com.sg
            </a>
          </p>

        </div>
      </div>

      <div class="modal-footer">
        <div class='col-xs-12'>
          <button type="button" class="btn btn-danger js-typeform" data-toggle="modal" data-target="#modal-unsubscribe-survey" data-order-id="">{% trans 'Cancel Subscription' %}</button>
          <button type="button" class="btn btn-default" data-dismiss="modal" style="margin-left: 1px;">{% trans 'Back' %}</button>
        </div>
      </div>

    </div>
  </div>
</div>
<!-- ./Cancel sub modal -->


<!-- Modal Referral - Invite by email-->
<div id="modal-referral-email" class="modal fade over-modal" role="dialog">
  <div class="modal-dialog modal-dialog--email">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body modal-body--email">

        <button type="button" class="close" data-dismiss="modal">&times;</button>

        <div class="referral-email-block">

          <p class="referral-email-intro">
            {% blocktrans trimmed %}
              Enter your friends email below (comma-separated) and we'll send them the invite.
              Remember the more invites the more points you get!
            {% endblocktrans %}
          </p>

          <form id="referral-emails-form" role="form" method="post" action="{% url 'referral_friends' %}">
            {% csrf_token %}
            <div class="form-group">
              {{ referral_form.raw_emails }}
            </div>
            <div class="help-block help-block--invites js-send-email-invites-msg"></div>
            <button type="submit" class="btn btn-primary js-send-email-invites-btn">{% trans 'SEND INVITES' %}</button>
            {% comment %}
            <div class="referral-btn-sep">{% trans 'OR' %}</div>
            <button type="button" class="btn btn-primary" onclick="google_auth()">{% trans 'Invite with gmail contacts' %}</button>
            {% endcomment %}
          </form>

        </div>

      </div>
    </div>

  </div>
</div>


<!-- Modal Referral - Invite by google conctacts -->
<div id="modal-referral-google-contacts" class="modal fade over-modal" role="dialog">
  <div class="modal-dialog modal-dialog--email">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-body modal-body--email">

        <button type="button" class="close" data-dismiss="modal">&times;</button>

        <div class="referral-email-block">

          <p class="referral-email-intro">
            {% trans 'Invite your contacts to join HookCoffee' %}
          </p>

          <div class="gcontacts-helpers">
            <label class="gcontacts-helpers__select-all">
              <input name="selectall" type="checkbox" onclick="select_all(this)">
              <span>{% trans 'Select All' %}</span>
            </label>
            <input type="text" class="form-control gcontacts-helpers__filter js-filter-gcontacts" placeholder="Your friend's name or email"/>
          </div>

          <form id="referral-gcontacts-form" role="form" method="post" action="{% url 'referral_friends' %}">
            {% csrf_token %}
            <ul class="gcontacts js-list-gcontacts"></ul>
            <div class="help-block help-block--invites js-send-email-invites-msg"></div>
            <button type="submit" class="btn btn-primary js-send-email-invites-btn">{% trans 'SEND INVITES' %}</button>
          </form>

        </div>

      </div>
    </div>

  </div>
</div>


<div id="modal-unsubscribe-survey" class="modal fade modal-survey" role="dialog">
    <div class="modal-content" style="height: 89%;">
      <button type="button" class="close close--surv" data-dismiss="modal">&times;</button>
    </div>
</div>

<div id="modal-unsubscribe-survey-warning" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <div class="modal-content">
      <div class="modal-body text-center">

        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <p>
          {% blocktrans trimmed %}
            Hang on! It seems like you're not done with the survey.<br/>
            Please complete it to confirm your cancellation.
          {% endblocktrans %}
        </p>
        <br/>
        <button type="button" class="btn btn-primary js-typeform" data-toggle="modal" data-target="#modal-unsubscribe-survey">{% trans 'Return to survey' %}</button>

      </div>
    </div>

  </div>
</div>


{% if show_customer_survey %}
  <div id="modal-exp-survey" class="modal fade modal-survey" role="dialog">
      <div class="modal-content" style="height: 89%;">
        <button type="button" class="close close--surv" data-dismiss="modal">&times;</button>
      </div>
  </div>
{% endif %}


{% comment %}
{# TODO: #}
<!-- /.modal-my brew recipe -->
<div class="modal fade"
	id="md-brewrecipe"
	tabindex="-1"
	role="dialog"
	aria-labelledby="md-brewrecipe">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button"
					class="close"
					data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>

				<div class="row">
					<div class="col-xs-12 col-md-6">
						<div class="brewrecipe-name">
							<h4>Honey, I Shrunk the Kids</h4>
              <div>
                <span class="glyphicon glyphicon-star text-primary"></span>
                <span class="glyphicon glyphicon-star text-primary"></span>
                <span class="glyphicon glyphicon-star text-primary"></span>
                <span class="glyphicon glyphicon-star text-primary"></span>
              </div>
							<p class="light">Brew recipe by: This User</p>
						</div>
					</div>
					<div class="col-xs-12 col-md-6">
						<div class="coffeeimg-wrapper" style="background-image: url('')">
						</div>
					</div>
				</div>
			</div>

			<div class="modal-body">
				<div class="row brewrecipe-info">
					<div class="brewrecipe-info-wrapper">

						<div class="info-col">
              <p class="s-h1">{% trans 'Brew Method' %}</p>
              <p class="s-h2-bold">Grind</p>
						</div>

						<div class="info-col">
              <p class="s-h1">{% trans 'Ratio' %}</p>
              <p class="s-h2-bold">1:2</p>
						</div>

						<div class="info-col">
              <p class="s-h1">{% trans 'Grind Size' %}</p>
              <p class="s-h2-bold">Fine</p>
						</div>

						<div class="info-col">
              <p class="s-h1">{% trans 'Grinder' %}</p>
              <p class="s-h2-bold">Inifinity Grinder</p>
						</div>

					</div>
				</div>

				<div class="modal-row modal-row-spaced-between">
          <p class="s-h1-bold">{% trans 'Methods' %}</p>
					<a class="btn btn-primary btn-hc btn-hc-xs">
            <span class="glyphicon glyphicon-plus"></span> {% trans 'Add Step' %}
					</a>
				</div>

				<div class="modal-row">
          <ol class="bullet">
            <li>
              <textarea class="form-control" id="placeholder-input1" rows="2">Pour milk into a steaming pitcher and heat to 145 degrees F to 165 degrees F (65 to 70 degrees C) using the steaming wand.</textarea>
            </li>

            <li>
              <textarea class="form-control" id="placeholder-input2" rows="2">Measure the flavored syrup into a large coffee mug. Brew espresso, then add to mug.</textarea>
            </li>

            <li>
              <textarea class="form-control" id="placeholder-input1" rows="2">Pour the steamed milk into the mug, using a spoon to hold back the foam. Spoon foam over the top.</textarea>
            </li>
          </ol>
        </div>
			</div>

      <div class="modal-footer">
        <p class="s-h1-bold pull-left"->{% trans 'Results' %}</p>

        <div class="modal-footer-share pull-right">
          <p class="s-h1-bold">{% trans 'Share this' %}</p>
          <img class="sh-fb" src='' />
          <img class="sh-tw" src='' />
          <img class="sh-gp" src='' />
        </div>
      </div>

		</div>
	</div>
</div>
<!-- /.modal-my brew recipe -->


<!-- modal-friend brew recipes -->
<div class="modal fade"
	id="md-friendbrewrecipe"
	tabindex="-1"
	role="dialog"
	aria-labelledby="md-friendbrewrecipe">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button"
					class="close"
					data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>

				<div class="row">
					<div class="col-xs-12 col-md-6">
						<div class="brewrecipe-name">
							<h4>Honey, I Shrunk the Kids</h4>
              <div>
                <span class="glyphicon glyphicon-star text-primary"></span>
                <span class="glyphicon glyphicon-star text-primary"></span>
                <span class="glyphicon glyphicon-star text-primary"></span>
                <span class="glyphicon glyphicon-star text-primary"></span>
              </div>
							<p class="light">Brew recipe by: Friend</p>
						</div>
					</div>
					<div class="col-xs-12 col-md-6">
						<div class="coffeeimg-wrapper" style="background-image: url('')">
						</div>
					</div>
				</div>
			</div>

			<div class="modal-body">
				<div class="row brewrecipe-info">
					<div class="brewrecipe-info-wrapper">

						<div class="info-col">
              <p class="s-h1">{% trans 'Brew Method' %}</p>
              <p class="s-h2-bold">Grind</p>
						</div>

						<div class="info-col">
              <p class="s-h1">{% trans 'Ratio' %}</p>
              <p class="s-h2-bold">1:2</p>
						</div>

						<div class="info-col">
              <p class="s-h1">{% trans 'Grind Size' %}</p>
              <p class="s-h2-bold">Fine</p>
						</div>

						<div class="info-col">
              <p class="s-h1">{% trans 'Grinder' %}</p>
              <p class="s-h2-bold">Inifinity Grinder</p>
						</div>

					</div>
				</div>

				<div class="modal-row modal-row-spaced-between">
          <p class="s-h1-bold">{% trans 'Methods' %}</p>
					<a class="btn btn-primary btn-hc btn-hc-xs">
            <span class="glyphicon glyphicon-plus"></span> {% trans 'Add Step' %}
					</a>
				</div>

				<div class="modal-row">
          <ol class="bullet">
            <li>
              <textarea class="form-control" id="placeholder-input1" rows="2">Pour milk into a steaming pitcher and heat to 145 degrees F to 165 degrees F (65 to 70 degrees C) using the steaming wand.</textarea>
            </li>

            <li>
              <textarea class="form-control" id="placeholder-input2" rows="2">Measure the flavored syrup into a large coffee mug. Brew espresso, then add to mug.</textarea>
            </li>

            <li>
              <textarea class="form-control" id="placeholder-input1" rows="2">Pour the steamed milk into the mug, using a spoon to hold back the foam. Spoon foam over the top.</textarea>
            </li>
          </ol>
        </div>
			</div>

      <div class="modal-footer">
        <p class="s-h1-bold pull-left"->{% trans 'Results' %}</p>

        <div class="modal-footer-share pull-right">
          <p class="s-h1-bold">{% trans 'Share this' %}</p>
          <img class="sh-fb" src='' />
          <img class="sh-tw" src='' />
          <img class="sh-gp" src='' />
        </div>
      </div>

		</div>
	</div>
</div>
<!-- /.modal-friend brew recipes -->


<!-- modal-friend summary -->
<div class="modal fade"
	id="md-friend"
	tabindex="-1"
	role="dialog"
	aria-labelledby="md-friend">
	<div class="modal-dialog" role="document">
		<div id="md-friend-content" class="modal-content">
			<div class="modal-body">
				<div>
					<button type="button"
						class="close"
						data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<p class="s-h2-bold">Friend Name</p>
				</div>

				<div class="modal-row modal-table">
					<ul class="nav nav-pills nav-justified" role="tablist">
						<li role="presentation" class="active">
							<a href="#tab-recently"
								aria-controls="tab-recently"
								role="tab"
								data-toggle="tab">
                {% trans 'Recently drinking' %}
							</a>
						</li>
						<li role="presentation">
							<a href="#tab-brewrecipes"
								aria-controls="tab-brewrecipes"
								role="tab"
								data-toggle="tab">
                {% trans 'Brew recipes' %}
							</a>
						</li>
					</ul>

					<div class="tab-content">
						<div role="tabpanel" class="tab-pane active" id="tab-recently">
							<table class="table table-hover">
								<tr>
									<td>
										<div class="media">
											<div class="media-left media-middle">
												<img class="img-circle" src='' width="40" height="40" />
											</div>
											<div class="media-body">
												<p>Honey I Shrunk the Kids</p>
												<div>
													<span class="glyphicon glyphicon-star text-primary"></span>
													<span class="glyphicon glyphicon-star text-primary"></span>
													<span class="glyphicon glyphicon-star text-primary"></span>
													<span class="glyphicon glyphicon-star text-primary"></span>
												</div>
											</div>
											<div class="media-right">
												<a class="btn btn-primary btn-hc btn-hc-xs"
													data-toggle="modal" data-target="#md-friendbrewrecipe">
                          {% trans 'See recipe' %}
												</a>
											</div>
										</div>
									</td>
								</tr>

								<tr>
									<td>
										<div class="media">
											<div class="media-left media-middle">
												<img class="img-circle" src='' width="40" height="40" />
											</div>
											<div class="media-body">
												<p>Sweet Bundchen</p>
												<div>
													<span class="glyphicon glyphicon-star text-primary"></span>
													<span class="glyphicon glyphicon-star text-primary"></span>
													<span class="glyphicon glyphicon-star text-primary"></span>
													<span class="glyphicon glyphicon-star text-primary"></span>
												</div>
											</div>
										</div>
									</td>
								</tr>

								<tr>
									<td>
										<div class="media">
											<div class="media-left media-middle">
												<img class="img-circle" src='' width="40" height="40" />
											</div>
											<div class="media-body">
												<p>Kopi Sutra</p>
												<div>
													<span class="glyphicon glyphicon-star text-primary"></span>
													<span class="glyphicon glyphicon-star text-primary"></span>
													<span class="glyphicon glyphicon-star text-primary"></span>
													<span class="glyphicon glyphicon-star text-primary"></span>
												</div>
											</div>
										</div>
									</td>
								</tr>
							</table>
						</div>
						<!-- /.table-recently drinking -->

						<div role="tabpanel" class="tab-pane" id="tab-brewrecipes">
							<table class="table table-hover">
								<tr>
									<td>
										<a data-toggle="modal" data-target="#md-friendbrewrecipe">
											<div class="media">
												<div class="media-left media-middle">
													<img class="img-circle" src='' width="40" height="40" />
												</div>
												<div class="media-body">
													<p>Kopi Sutra</p>
													<div>
														<span class="glyphicon glyphicon-star text-primary"></span>
														<span class="glyphicon glyphicon-star text-primary"></span>
														<span class="glyphicon glyphicon-star text-primary"></span>
														<span class="glyphicon glyphicon-star text-primary"></span>
													</div>
												</div>
											</div>
										</a>
									</td>
								</tr>
							</table>
							<!-- /.table-brew recipes -->
						</div>
					</div>
				</div>
				<!-- /.row -->

			</div>
		</div>
		<!-- /#md-friend-content -->
	</div>
</div>
<!-- /.modal-friend summary -->


<!-- modal-follow -->
<div class="modal fade"
	id="md-follow"
	tabindex="-1"
	role="dialog"
	aria-labelledby="md-follow">
	<div class="modal-dialog" role="document">
		<div id="md-findfriends-content" class="modal-content">
			<div class="modal-body">
				<div>
					<button type="button"
						class="close"
						data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
          <p class="s-h2-bold">{% trans 'Follow' %}</p>
				</div>

				<div class="modal-row modal-table">
					<ul class="nav nav-pills nav-justified" role="tablist">
						<li role="presentation" class="active">
							<a href="#tab-fbfriends"
								aria-controls="tab-fbfriends"
								role="tab"
								data-toggle="tab">
                {% trans 'Facebook friends' %}
							</a>
						</li>
						<li role="presentation">
							<a href="#tab-featured"
								aria-controls="tab-featured"
								role="tab"
								data-toggle="tab">
                {% trans 'Featured' %}
							</a>
						</li>
					</ul>

					<!-- Tab panes -->
					<div class="tab-content">
						<div role="tabpanel" class="tab-pane active" id="tab-fbfriends">
							<table class="table table-hover">
								<tr>
									<td>
										<div class="media">
											<div class="media-left media-middle">
												<img class="img-circle" src='' width="40" height="40" />
											</div>
											<div class="media-body">
												<p>Adele Lu</p>
											</div>
											<div class="media-right">
												<a class="btn btn-primary btn-hc btn-hc-xs">
                          {% trans 'Follow' %}
												</a>
											</div>
										</div>
									</td>
								</tr>

								<tr>
									<td>
										<div class="media">
											<div class="media-left media-middle">
												<img class="img-circle" src='' width="40" height="40" />
											</div>
											<div class="media-body">
												<p>Faye Sit</p>
											</div>
											<div class="media-right">
												<a class="btn btn-primary btn-hc btn-hc-xs">
                          {% trans 'Follow' %}
												</a>
											</div>
										</div>
									</td>
								</tr>

								<tr>
									<td>
										<div class="media">
											<div class="media-left media-middle">
												<img class="img-circle" src='' width="40" height="40" />
											</div>
											<div class="media-body">
												<p>Tim Tam</p>
											</div>
											<div class="media-right">
												<a class="btn btn-primary btn-hc btn-hc-xs">
                          {% trans 'Follow' %}
												</a>
											</div>
										</div>
									</td>
								</tr>
							</table>
						</div>
						<!-- /.table-facebook friends -->

						<div role="tabpanel" class="tab-pane" id="tab-featured">
							<table class="table table-hover">
								<tr>
									<td>
										<div class="media">
											<div class="media-left media-middle">
												<img class="img-circle" src='' width="40" height="40" />
											</div>
											<div class="media-body">
												<p>Adele Lu</p>
											</div>
											<div class="media-right">
												<a class="btn btn-primary btn-hc btn-hc-xs">
                          {% trans 'Follow' %}
												</a>
											</div>
										</div>
									</td>
								</tr>

								<tr>
									<td>
										<div class="media">
											<div class="media-left media-middle">
												<img class="img-circle" src='' width="40" height="40" />
											</div>
											<div class="media-body">
												<p>Faye Sit</p>
											</div>
											<div class="media-right">
												<a class="btn btn-primary btn-hc btn-hc-xs">
                          {% trans 'Follow' %}
												</a>
											</div>
										</div>
									</td>
								</tr>
							</table>
						</div>
						<!-- /.table-featured -->
					</div>

				</div>
				<!-- /.row -->

			</div>
		</div>
		<!-- /#md-findfriends-content -->
	</div>
</div>
<!-- /.modal-follow -->
{% endcomment %}

<!-- Start of CHANGE EMAIL MODAL -->
<div class="modal fade" id="changeEmail" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<!-- Body -->
			<div class="modal-body">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<div class="modal-row modal-row-header">
					<p class="header text-center">
            {% trans 'Change your Email' %}
          </p>
				</div>

				<div class='row'>
					<div class="col-md-12">
						<div class="form-group">
							<label for="userEmailChangeNew">
                {% trans 'Enter your email address' %}
							</label>
							<input id="userEmailChangeNew" type="text" class="form-control" value="Email">
						</div>
					</div>
				</div>

				<div class='row'>
					<div class="col-md-12">
						<div class="form-group">
							<label for="userEmailChangeConfirm">
                {% trans 'Confirm your email address' %}
							</label>
							<input type="text" id="userEmailChangeConfirm" class="form-control" value="Password">
						</div>
					</div>
				</div>

			</div>

			<!-- Footer -->
			<div class="modal-footer">
				<div class='col-md-12 text-center'>
					<button type="button" class="btn btn-primary" data-dismiss="modal">
            {% trans 'Change Email' %}
          </button>
				</div>
			</div>
		</div>
	</div>
</div>
<!-- End of CHANGE EMAIL MODAL -->


<!-- Start of CHANGE PASSWORD MODAL -->
<div class="modal fade" id="changePassword" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">

      <form class="js-update-profile" method="POST" action="{% url 'change_customer_password' %}" >
        {% csrf_token %}

  			<!-- Body -->
  			<div class="modal-body">
  				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>

  				<div class="modal-row modal-row-header">
  					<p class="header text-center">
              {% trans 'Change your Password' %}
            </p>
  				</div>

  				<div class='row'>
  					<div class="col-md-12">
  						<div class="form-group form-group--old_password">
  							<label for="id_old_password">
                  {% trans 'Enter your current password' %}
  							</label>
                <input type="password"
                  id="id_old_password"
                  name="old_password"
                  class="form-control"
                  placeholder="Current password"
                >
                <span class="help-block"></span>
  						</div>
  					</div>
  				</div>

  				<div class='row'>
  					<div class="col-md-12">
              <div class="form-group form-group--new_password1">
                <label for="id_new_password1">
                  {% trans 'Enter your new password' %}
                </label>
                <input type="password"
                  id="id_new_password1"
                  name="new_password1"
                  class="form-control"
                  placeholder="New password"
                >
                <span class="help-block"></span>
              </div>
  					</div>
  				</div>

  				<div class='row'>
  					<div class="col-md-12">
              <div class="form-group form-group--new_password2">
                <input type="password"
                  id="id_new_password2"
                  name="new_password2"
                  class="form-control"
                  placeholder="Confirm new password"
                >
                <span class="help-block"></span>
              </div>
  					</div>
  				</div>
  			</div>
        <!-- / Body -->

  			<!-- Footer -->
  			<div class="modal-footer">
  				<div class='col-md-12 text-center'>
            <input type="hidden" name="submit-customer-password" />
  					<button type="submit" class="btn btn-primary hide-modal">
              {% trans 'Change Password' %}
            </button>
  				</div>
  			</div>
        <!-- /Footer -->

      </form>

		</div>
	</div>
</div>
<!-- End of CHANGE PASSWORD MODAL -->


<!-- Start of Choose new coffee modal Bags -->
<div class="modal fade" id="chooseNewCoffeeBags" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!-- Body -->
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>

        <div class="modal-body-section__md">

          {% for coffee in coffees %}
            <div class="coffee-box">
              <form class="js-change-order-coffee" method="POST" action="{% url 'change_order_coffee' %}"
                data-coffee-name="{{ coffee.name }}"
                data-coffee-img="{{ coffee.img.url }}"
              >
                {% csrf_token %}

                <div class="cb-info cb-header">
                  <h4>{{ coffee.name }}</h4>
                  <small>
                    <i class="fa fa-map-marker"></i>
                    {{ coffee.region }}, {{ coffee.get_country_display }}
                  </small>
                </div>

                <div class="cb-img" style='background-image: url({{ coffee.img.url }})'></div>

                <div class="cb-info">
                  <p class="c-taste">
                    <em>{% trans 'Hints of'%}<br/><strong>{{ coffee.taste }}</strong></em>
                  </p>
                  <p class="c-bdisplay">{{ coffee.get_body_display }}</p>

                  <table>
                    <tr>
                      <td class="s-h1-bold">{% trans 'Roasted on' %}</td>
                      <td><p>{{ coffee.roasted_on }}</p></td>
                    </tr>

                    <tr>
                      <td class="s-h1-bold">{% trans 'Upcoming roast' %}</td>
                      <td><p>{{ coffee.shipping_till }}</p></td>
                    </tr>
                  </table>
                </div>

                {# Start -> special coffee footer #}
                <div class="cb-info cb-footer">
                  <div class="c-price">
                    <p class="s-h2">S${{coffee.amount}}</p>
                    <p><small>(Free P&P)</small></p>
                  </div>

                  <input type="hidden" name="order" value=""/>
                  <input type="hidden" name="coffee" value="{{ coffee.id }}"/>
                  <button type="submit" class="btn btnx btn-primary btn-hc btn-hc-sm">
                    {% trans 'Ship Next' %}
                  </button>
                </div>
                {# End -> special coffee footer #}
              </form>
            </div>
          {% endfor %}

        </div>

      </div>
    </div>
  </div>
</div>
<!-- End of Choose new coffee modal Bags -->

<!-- Start of Choose new coffee modal Pods -->
<div class="modal fade" id="chooseNewCoffeePods" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!-- Body -->
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>

        <div class="modal-body-section__md">

          {% for coffee in coffees_pods %}
            <div class="coffee-box">
              <form class="js-change-order-coffee" method="POST" action="{% url 'change_order_coffee' %}"
                data-coffee-name="{{ coffee.name }}"
                data-coffee-img="{{ coffee.img.url }}"
              >
                {% csrf_token %}

                <div class="cb-info cb-header">
                  <h4>{{ coffee.name }}</h4>
                  <small>
                    <i class="fa fa-map-marker"></i>
                    {{ coffee.region }}, {{ coffee.get_country_display }}
                  </small>
                </div>

                <div class="cb-img" style='background-image: url({{ coffee.img.url }})'></div>

                <div class="cb-info">
                  <p class="c-taste">
                    <em>{% trans 'Hints of'%}<br/><strong>{{ coffee.taste }}</strong></em>
                  </p>
                  <p class="c-bdisplay">{{ coffee.get_body_display }}</p>

                  <table>
                    <tr>
                      <td class="s-h1-bold">{% trans 'Roasted on' %}</td>
                      <td><p>{{ coffee.roasted_on }}</p></td>
                    </tr>

                    <tr>
                      <td class="s-h1-bold">{% trans 'Upcoming roast' %}</td>
                      <td><p>{{ coffee.shipping_till }}</p></td>
                    </tr>
                  </table>
                </div>

                {# Start -> special coffee footer #}
                <div class="cb-info cb-footer">
                  <div class="c-price">
                    <p class="s-h2">S${{coffee.amount}}</p>
                    <p><small>(Free P&P)</small></p>
                  </div>

                  <input type="hidden" name="order" value=""/>
                  <input type="hidden" name="coffee" value="{{ coffee.id }}"/>
                  <button type="submit" class="btn btnx btn-primary btn-hc btn-hc-sm">
                    {% trans 'Ship Next' %}
                  </button>
                </div>
                {# End -> special coffee footer #}
              </form>
            </div>
          {% endfor %}

        </div>

      </div>
    </div>
  </div>
</div>
<!-- End of Choose new coffee modal Pods -->

<!-- Start of Choose new coffee modal Bottled -->
<div class="modal fade" id="chooseNewCoffeeBottled" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <!-- Body -->
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>

        <div class="modal-body-section__md">

          {% for coffee in coffees_bottled %}
            <div class="coffee-box">
              <form class="js-change-order-coffee" method="POST" action="{% url 'change_order_coffee' %}"
                data-coffee-name="{{ coffee.name }}"
                data-coffee-img="{{ coffee.img.url }}"
              >
                {% csrf_token %}

                <div class="cb-info cb-header">
                  <h4>{{ coffee.name }}</h4>
                  <small>
                    <i class="fa fa-map-marker"></i>
                    {{ coffee.region }}, {{ coffee.get_country_display }}
                  </small>
                </div>

                <div class="cb-img" style='background-image: url({% static coffee.img.url %})'></div>

                <div class="cb-info">
                  <p class="c-taste">
                    <em>{% trans 'Hints of'%}<br/><strong>{{ coffee.taste }}</strong></em>
                  </p>
                  <p class="c-bdisplay">{{ coffee.get_body_display }}</p>

                  <table>
                    <tr>
                      <td class="s-h1-bold">{% trans 'Roasted on' %}</td>
                      <td><p>{{ coffee.roasted_on }}</p></td>
                    </tr>

                    <tr>
                      <td class="s-h1-bold">{% trans 'Upcoming roast' %}</td>
                      <td><p>{{ coffee.shipping_till }}</p></td>
                    </tr>
                  </table>
                </div>

                {# Start -> special coffee footer #}
                <div class="cb-info cb-footer">
                  <div class="c-price">
                    <p class="s-h2">S${{coffee.amount}}</p>
                    <p><small>(Free P&P)</small></p>
                  </div>

                  <input type="hidden" name="order" value=""/>
                  <input type="hidden" name="coffee" value="{{ coffee.id }}"/>
                  <button type="submit" class="btn btnx btn-primary btn-hc btn-hc-sm">
                    {% trans 'Ship Next' %}
                  </button>
                </div>
                {# End -> special coffee footer #}
              </form>
            </div>
          {% endfor %}

        </div>

      </div>
    </div>
  </div>
</div>
<!-- End of Choose new coffee modal Bottled -->


<!-- Start of Order Details -->
<div class="modal fade"
	id="md-orderdetails"
	tabindex="-1"
	role="dialog"
	aria-labelledby="md-orderdetails">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button"
					class="close"
					data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>

				<div class="row">
					<div class="col-xs-12 col-md-6">
						<div class="brewrecipe-name">
							<h4 class="js-order-name"></h4>
              <div class="js-coffee-avg-rating"></div>

              <p class="s-h1-bold">
                <span class="js-order-package"></span>
                <span class="js-order-brew"></span>
                <span class="js-order-status"></span>
              </p>
              <p class="s-h3 js-order-shipping-date"></p>

              <p class="s-h1-bold">{% trans 'EXPECTED DELIVERY DATE' %}</p>
              <p class="s-h3 js-estimate-delivery"></p>

              <p class="s-h1-bold">{% trans 'To' %}</p>
              <p class="s-h3 js-order-address"></p>

              <p class="s-h1-bold js-order-currency">{% trans 'Price' %}</p>
              <p class="s-h3">
                <span class="js-order-price"></span>
                <small class="js-order-type">({% trans 'Subscription' %})</small>
              </p>

              <p class="s-h1-bold">{% trans 'Tracking Number' %}</p>
              <p class="s-h3 js-order-tracking"></p>

              <div class="order-btns">
                {# TODO #}
                <button class="btn btn-primary btn-hc btn-hc-xs js-show-order-review-modal"
                  data-order-id=""
                  data-order-rating=""
                  data-order-review=""
                  data-coffee-id=""
                  data-coffee-name=""
                  data-toggle="modal"
                  data-target="#md-orderreview">
                  {% trans 'Review' %}
                </button>
                {% comment %}
                <button class="btn btn-primary btn-hc btn-hc-xs"
                  data-toggle="modal" data-target="#md-brewrecipe">
                  {% trans 'My Brew Recipe' %}
                </button>
                {% endcomment %}
              </div>

						</div>
					</div>

					<div class="col-xs-12 col-md-6">
						<div class="coffeeimg-wrapper js-order-image" style="background-image: url('')">
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>
</div>
<!-- Start of Order Details -->


<!-- Start of Order Review -->
<div class="modal fade" id="md-orderreview" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
      <form method="POST" action="{% url 'create_order_review' %}" class="js-create-order-review">
        {% csrf_token %}

  			<!-- Body -->
  			<div class="modal-body">
  				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>

  				<div class="modal-row modal-row-header">
  					<p>
              {% trans 'Give a review for' %} <span class="js-coffee-name"></span>
            </p>
  				</div>

  				<div class="modal-row modal-row-hero">
            <div class="form-group">
              <label>{% trans 'Give it stars' %}</label>
              <div class="form-star-review s-h5">
                <i class="fa fa-star-o" data-value="1" aria-hidden="true"></i>
                <i class="fa fa-star-o" data-value="2" aria-hidden="true"></i>
                <i class="fa fa-star-o" data-value="3" aria-hidden="true"></i>
                <i class="fa fa-star-o" data-value="4" aria-hidden="true"></i>
                <i class="fa fa-star-o" data-value="5" aria-hidden="true"></i>
              </div>
              <span class="help-block help-block--rating hide"></span>
              <div class="form-star-review-rated s-h5">
                <i class="fa fa-star-o" data-value="1" aria-hidden="true"></i>
                <i class="fa fa-star-o" data-value="2" aria-hidden="true"></i>
                <i class="fa fa-star-o" data-value="3" aria-hidden="true"></i>
                <i class="fa fa-star-o" data-value="4" aria-hidden="true"></i>
                <i class="fa fa-star-o" data-value="5" aria-hidden="true"></i>
              </div>
            </div>

            <div class="form-group brew-block">
              <label>{% trans 'How did you prepare this coffee?' %}</label>
              <div class="dropdown">
                <button
                  class="btn dropdown-toggle btn-hc btn-hc-xs btn-primary-inv"
                  type="button"
                  id="addsubs-brewmethod"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="true">
                  <div class="dropdown-item">
                    {% with brew=brew_methods|first %}
                      <img class="coffee-img" src="{{ brew.img.url }}" />
                      <span id="review-brewmethod">{{ brew.name }}</span>
                    {% endwith %}
                  </div>
                  <span class="caret"></span>
                </button>

                <ul class="dropdown-menu">
                  {% for brew in brew_methods %}
                    <li class="coffee-dropdown">
                      <a class="dropdown-item" data-type="brew" data-object-id="{{ brew.id }}" href="#">
                        <img class="coffee-img" src="{{ brew.img.url }}" />
                        <span>{{ brew.name }}</span>
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>
            <div class="form-group">
              <label>{% trans 'Comment' %}</label>
              <div class="form">
                <textarea type="text" name="comment" class="form-control" rows="2" maxlength="1024"></textarea>
              </div>
            </div>
  				</div>
  			</div>

  			<!-- Footer -->
  			<div class="modal-footer">
  				<div class='col-md-12 text-center'>
            <input type="hidden" name="rating" value=""/>
            <input type="hidden" name="brew" value=""/>
            <input type="hidden" name="order" value=""/>
            <input type="hidden" name="coffee" value=""/>
  					<button type="submit" class="btn btn-primary">
              {% trans 'Submit Review' %}
            </button>
  				</div>
  			</div>

      </form>
		</div>
	</div>
</div>
<!-- Start of Order Review -->

{% comment %}
<!-- Add a new one-off modal -->
<div class="modal modal-hc modal-form fade new-order"
  id="addNewOneOffBags"
  tabindex="-1"
  data-backdrop="static"
  role="dialog"
  aria-labelledby="Add a new subscription">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <p class="s-h2"><b>{% trans 'Buy ONE-OFF' %}</b></p>
      </div>

      <div class="modal-body js-curr-subscription">
        <div class="modal-body-section__sm">

          <form method="POST" action="{% url 'create_order' %}" class="js-create-order">
            {% csrf_token %}
            <div class="form-group">
              <label>{% trans 'Choose a coffee' %}</label>

              <div class="dropdown">
                <button
                  class="btn dropdown-toggle btn-hc btn-hc-xs btn-primary-inv"
                  type="button"
                  id="addsubs-brewmethod"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="true">
                  <div class="dropdown-item">
                      <img class="coffee-img js-selected-coffee" data-coffee-id='0' src="/media/none.png" />
                      <span> ----------- </span>
                  </div>
                  <span class="caret"></span>
                </button>

                <ul class="dropdown-menu">
                  {% for coffee in coffees %}
                    <li class="coffee-dropdown">
                      <a class="dropdown-item" data-coffee-id="{{ coffee.id }}" href="#">
                        <img class="coffee-img" src="{{ coffee.img.url }}" />
                        <span>{{ coffee.name }}</span>
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>

            <div class="form-group">
              <label>{% trans 'How do you want your coffee packaged?' %}</label>

              <div class="form-option-list">
                {% for key, value in preferences_form.package.field.choices %}
                  <div data-value="{{ key }}"
                  class="form-option opt-pack pref-option {% if key == new_order_form_bags.package.value %}selected{% endif %} {{ key }}-opt {% if key == 'BB' %} hide {% endif %}">
                    <div class="form-option-wrapper">
                      <div class="img-thumbnail" style="background-image: url({% static 'images/package_methods/' %}{% if key == 'GR' %}ground{% elif key == 'WB' %}wholebeans{% elif key == 'DR' %}dripbag{% elif key == 'BB' %}brew_bags{% endif %}.png)"></div>
                      <p class="s-h1">{{ value }}</p>
                    </div>
                  </div>
                {% endfor%}
              </div>
            </div>

            <div class="form-group">
              <div class="modal-footer">
                <input type="hidden" name="recurrent" value="False"/>
                <input type="hidden" name="address" value="-1"/>
                {{ new_order_form_bags.coffee.as_hidden }}
                {{ new_order_form_bags.brew.as_hidden }}
                {{ new_order_form_bags.package.as_hidden }}
                <button type="submit" class="btn btn-primary btn-hc">{% trans 'Buy ONE-OFF' %}</button>
              </div>
            </div>

          </form>
        </div>
      </div>

    </div>
    <!--modal-content-->
  </div>
  <!--modal-dialog-->
</div>
<!-- Add a new one-off modal -->

<!-- Add a new one-off pods modal -->
<div class="modal modal-hc modal-form fade new-order"
  id="addNewOneOffPods"
  tabindex="-1"
  data-backdrop="static"
  role="dialog"
  aria-labelledby="Add a new subscription">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <p class="s-h2"><b>{% trans 'Buy ONE-OFF' %}</b></p>
      </div>

      <div class="modal-body js-curr-subscription">
        <div class="modal-body-section__sm">

          <form method="POST" action="{% url 'create_order' %}" class="js-create-order">
            {% csrf_token %}
            <div class="form-group">
              <label>{% trans 'Choose a coffee' %}</label>

              <div class="dropdown">
                <button
                  class="btn dropdown-toggle btn-hc btn-hc-xs btn-primary-inv"
                  type="button"
                  id="addsubs-brewmethod"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="true">
                  <div class="dropdown-item">
                      <img class="coffee-img js-selected-coffee" data-coffee-id='0' src="/media/none.png" />
                      <span> ----------- </span>
                  </div>
                  <span class="caret"></span>
                </button>

                <ul class="dropdown-menu">
                  {% for coffee in coffees_pods %}
                    <li class="coffee-dropdown">
                      <a class="dropdown-item" data-coffee-id="{{ coffee.id }}" href="#">
                        <img class="coffee-img" src="{{ coffee.img.url }}" />
                        <span>{{ coffee.name }}</span>
                      </a>
                    </li>
                  {% endfor %}
                </ul>

              </div>
            </div>

            <div class="form-group">
              <div class="modal-footer">
                <input type="hidden" name="recurrent" value="False"/>
                <input type="hidden" name="address" value="-1"/>
                {{ new_order_form_pods.coffee.as_hidden }}
                {{ new_order_form_pods.brew.as_hidden }}
                {{ new_order_form_pods.package.as_hidden }}
                <button type="submit" class="btn btn-primary btn-hc">{% trans 'Buy ONE-OFF' %}</button>
              </div>
            </div>

          </form>
        </div>
      </div>

    </div>
    <!--modal-content-->
  </div>
  <!--modal-dialog-->
</div>
<!-- Add a new one-off pods modal -->
{% endcomment %}

{% if not is_worldwide %} {# Just in case #}
<!-- Add a new subscription modal -->
<div class="modal modal-hc modal-form fade new-order js-modal-new-order js-modal-new-order-0"
  id="addNewSubsBags"
  tabindex="-1"
  data-backdrop="static"
  role="dialog"
  aria-labelledby="Add a new subscription">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <p class="s-h2"><b>{% trans 'Add new subscription' %}</b></p>
      </div>

      <div class="modal-body js-curr-subscription">
        <div class="modal-body-section__sm">

          <form method="POST" action="{% url 'create_order' %}" class="js-create-order">
            {% csrf_token %}
            <div class="form-group">
              <label>{% trans 'Choose a coffee' %}</label>

              <div class="dropdown">
                <button
                  class="btn dropdown-toggle btn-hc btn-hc-xs btn-primary-inv"
                  type="button"
                  id="addsubs-bag"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="true">
                  <div class="dropdown-item">
                    {% with coffee=coffees.0 %}
                      <img class="coffee-img" src="{{ coffee.img.url }}" />
                      <span>{{ coffee.name }}</span>
                    {% endwith %}
                  </div>
                  <span class="caret"></span>
                </button>

                <ul class="dropdown-menu">
                  {% for coffee in coffees %}
                    <li class="coffee-dropdown">
                      <a class="dropdown-item" data-type="coffee" data-object-id="{{ coffee.id }}" href="#">
                        <img class="coffee-img" src="{{ coffee.img.url }}" />
                        <span>{{ coffee.name }}</span>
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>

            <div class="form-group">
              <label>{% trans 'How do you want your coffee packaged?' %}</label>

              <div class="form-option-list">
                {% for key, value in preferences_form.package.field.choices %}
                  <div data-value="{{ key }}"
                  class="form-option opt-pack pref-option {% if key == new_order_form_bags.package.value %}selected{% endif %} {{ key }}-opt {% if key == 'BB' %} hide {% endif %}">
                    <div class="form-option-wrapper">
                      <div class="img-thumbnail" style="background-image: url({% static 'images/package_methods/' %}{% if key == 'GR' %}ground{% elif key == 'WB' %}wholebeans{% elif key == 'DR' %}dripbag{% elif key == 'BB' %}brew_bags{% endif %}.png)"></div>
                      <p class="s-h1">{{ value }}</p>
                    </div>
                  </div>
                {% endfor%}
              </div>
            </div>

            <div class="form-group">
              <label>{% trans 'How do you make your coffee?' %}</label>
              <div class="dropdown">
                <button
                  class="btn dropdown-toggle btn-hc btn-hc-xs btn-primary-inv"
                  type="button"
                  id="addsubs-brewmethod"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="true">
                  <div class="dropdown-item">
                    {% with brew=brew_methods|last %}
                      <img class="coffee-img" src="{{ brew.img.url }}" />
                      <span>{{ brew.name }}</span>
                    {% endwith %}
                  </div>
                  <span class="caret"></span>
                </button>

                <ul class="dropdown-menu">
                  {% for brew in brew_methods %}
                    <li class="coffee-dropdown">
                      <a class="dropdown-item" data-type="brew" data-object-id="{{ brew.id }}" href="#">
                        <img class="coffee-img" src="{{ brew.img.url }}" />
                        <span>{{ brew.name }}</span>
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>

            <div class="form-group form-group-slider test_css">
              <label>{% trans 'Tell us how often youâ€™d like us to deliver your coffee' %}</label>

              <p>A fresh bag every
                <span class="" id="frequency-days-bags"></span>
                days is equivalent to roughly
                <span class="" id="frequency-cups-bags"></span>
                cups of coffee a week
              </p>

              <div class="row">
                <div class="col-xs-10 col-xs-offset-1 frequency-slider">
                  <input id="range-slider-bags" type="range" min="1" max="30" step="1" value="14">
                </div>
              </div>

              <p>
                Donâ€™t worry! You are not locked into any frequency, you can change it
                <br>
                later on or order emergency bags on your account page.
              </p>

            </div>

            <div class="form-group form-group-slider test_css">
              <div class="col-xs-12">
                  {% if not coffee.is_discovery_pack %}

                      <div class="col-xs-12" style="padding-top:20px;">
                        <div class="btn-group" data-toggle="buttons">
                          <label id="same" class="btn btn-default btn-hc-sm opt-diff" data-value=false>
                            <input type="radio" /> {% trans 'Same' %}
                          </label>
                          <label id="different" class="btn btn-default btn-hc-sm opt-diff active" data-value=true title="We will send you a random&#013;selection of coffees. However &#013;occasional we might send you the &#013;same thing, so do check back to &#013;change your coffee selection!">
                            <input type="radio" /> {% trans 'Surprise me' %}
                          </label>
                        </div>
                      </div>
                  {% endif %}
                </div>
            </div>

            <div class="form-group">
              <div class="panel panel-form">
                <div class="panel-body">
                  <div class="panel-row">

                    <div class="panel-group"
                      id="addsub-modal-addr"
                      role="tablist"
                      aria-multiselectable="true">
                      <div class="header col-xs-12">
                        {% trans 'Shipping Address' %}
                        <a role="button"
                          data-toggle="collapse"
                          data-parent="#addsub-modal-addr"
                          href="#addsub-modal-addr-change"
                          aria-expanded="true">
                          {% trans 'Change Address' %}
                        </a>
                      </div>

                      {% for form in addresses_forms %}
                        {% if form.is_primary.value %}
                          <p class="selected-addr">
                            <span class="addr-name">
                              {{ form.name.value }}
                            </span>
                            <span class="addr">
                              {{ form.line1.value }} {{ form.line2.value }},
                              <br />
                              {% firstof form.initial.country.name form.instance.country.name %}
                              {{ form.postcode.value }}
                            </span>
                          </p>
                        {% endif %}
                      {% endfor %}
                    </div>

                    <div id="addsub-modal-addr-change"
                      class="panel-collapse collapse"
                      role="tabpanel">
                      <ul class="address-list js-address-list">

                        {% for form in addresses_forms %}
                          <li data-subid="subs-addr-change"
                            {# data-order-id="{{ order.id }}" #}
                            data-parent-id="addsub-modal-addr"
                            data-addr-id="{{ form.initial.id }}"
                            {% if form.is_primary.value %}
                              class="selected"
                            {% endif %}
                            >
                            <div>
                              <p><b class="js-addr-name">{{ form.name.value }}</b></p>
                              <p><small class="js-addr-recipient_name">{{ form.recipient_name.value }}</small></p>
                              <p class="js-addr-lines">
                                {{ form.line1.value }} {{ form.line2.value }},
                                <br />
                                {% firstof form.initial.country.name form.instance.country.name %}
                                {{ form.postcode.value }}
                              </p>
                            </div>
                            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                          </li>
                        {% endfor %}

                      </ul>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <div class="form-group">
              <div class="modal-footer">
                {{ new_order_form_bags.coffee.as_hidden }}
                {{ new_order_form_bags.brew.as_hidden }}
                {{ new_order_form_bags.package.as_hidden }}
                {{ new_order_form_bags.interval.as_hidden }}
                {{ new_order_form_bags.different.as_hidden }}
                {{ new_order_form_bags.address.as_hidden }}
                <button type="submit" class="btn btn-primary btn-hc">{% trans 'Subscribe' %}</button>
              </div>
            </div>

          </form>
        </div>
      </div>

    </div>
    <!--modal-content-->
  </div>
  <!--modal-dialog-->
</div>
<!-- Add a new subscription modal -->
{% endif %}

{% if not is_worldwide %} {# Just in case #}
<!-- Add a new subscription modal -->
<div class="modal modal-hc modal-form fade new-order js-modal-new-order js-modal-new-order-1"
  id="addNewSubsPods"
  tabindex="-1"
  data-backdrop="static"
  role="dialog"
  aria-labelledby="Add a new subscription">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <p class="s-h2"><b>{% trans 'Add new subscription' %}</b></p>
      </div>

      <div class="modal-body js-curr-subscription">
        <div class="modal-body-section__sm">

          <form method="POST" action="{% url 'create_order' %}" class="js-create-order">
            {% csrf_token %}
            <div class="form-group">
              <label>{% trans 'Choose a coffee' %}</label>

              <div class="dropdown">
                <button
                  class="btn dropdown-toggle btn-hc btn-hc-xs btn-primary-inv"
                  type="button"
                  id="addsubs-pod"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="true">
                  <div class="dropdown-item">
                    {% with coffee=coffees_pods.0 %}
                      <img class="coffee-img" src="{{ coffee.img.url }}" />
                      <span>{{ coffee.name }}</span>
                    {% endwith %}
                  </div>
                  <span class="caret"></span>
                </button>

                <ul class="dropdown-menu">
                  {% for coffee in coffees_pods %}
                    <li class="coffee-dropdown">
                      <a class="dropdown-item" data-type="coffee" data-object-id="{{ coffee.id }}"  href="#">
                        <img class="coffee-img" src="{{ coffee.img.url }}" />
                        <span>{{ coffee.name }}</span>
                      </a>
                    </li>
                  {% endfor %}
                </ul>

              </div>
            </div>

            <div class="form-group form-group-slider test_css">
              <label>{% trans 'Tell us how often youâ€™d like us to deliver your coffee' %}</label>

              <p>A fresh bag every
                <span class="" id="frequency-days-pods"></span>
                days is equivalent to roughly
                <span class="" id="frequency-cups-pods"></span>
                cups of coffee a week
              </p>

              <div class="row">
                <div class="col-xs-10 col-xs-offset-1 frequency-slider">
                  <input id="range-slider-pods" type="range" min="1" max="30" step="1" value="14">
                </div>
              </div>

              <p>
                Donâ€™t worry! You are not locked into any frequency, you can change it
                <br>
                later on or order emergency bags on your account page.
              </p>

            </div>

            <div class="form-group">
              <div class="panel panel-form">
                <div class="panel-body">
                  <div class="panel-row">

                    <div class="panel-group"
                      id="addsub-modal-addr-pods"
                      role="tablist"
                      aria-multiselectable="true">
                      <div class="header col-xs-12">
                        {% trans 'Shipping Address' %}
                        <a role="button"
                          data-toggle="collapse"
                          data-parent="#addsub-modal-addr-pods"
                          href="#addsub-modal-addr-change-pods"
                          aria-expanded="true">
                          {% trans 'Change Address' %}
                        </a>
                      </div>

                      {% for form in addresses_forms %}
                        {% if form.is_primary.value %}
                          <p class="selected-addr">
                            <span class="addr-name">
                              {{ form.name.value }}
                            </span>
                            <span class="addr">
                              {{ form.line1.value }} {{ form.line2.value }},
                              <br />
                              {% firstof form.initial.country.name form.instance.country.name %}
                              {{ form.postcode.value }}
                            </span>
                          </p>
                        {% endif %}
                      {% endfor %}
                    </div>

                    <div id="addsub-modal-addr-change-pods"
                      class="panel-collapse collapse"
                      role="tabpanel">
                      <ul class="address-list js-address-list">

                        {% for form in addresses_forms %}
                          <li data-subid="subs-addr-change"
                            data-parent-id="addsub-modal-addr-pods"
                            data-addr-id="{{ form.initial.id }}"
                            {% if form.is_primary.value %}
                              class="selected"
                            {% endif %}
                            >
                            <div>
                              <p><b class="js-addr-name">{{ form.name.value }}</b></p>
                              <p><small class="js-addr-recipient_name">{{ form.recipient_name.value }}</small></p>
                              <p class="js-addr-lines">
                                {{ form.line1.value }} {{ form.line2.value }},
                                <br />
                                {% firstof form.initial.country.name form.instance.country.name %}
                                {{ form.postcode.value }}
                              </p>
                            </div>
                            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                          </li>
                        {% endfor %}

                      </ul>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <div class="form-group">
              <div class="modal-footer">
                {{ new_order_form_pods.coffee.as_hidden }}
                {{ new_order_form_pods.brew.as_hidden }}
                {{ new_order_form_pods.package.as_hidden }}
                {{ new_order_form_pods.interval.as_hidden }}
                {{ new_order_form_pods.different.as_hidden }}
                {{ new_order_form_pods.address.as_hidden }}
                <button type="submit" class="btn btn-primary btn-hc">{% trans 'Subscribe' %}</button>
              </div>
            </div>

          </form>
        </div>
      </div>

    </div>
    <!--modal-content-->
  </div>
  <!--modal-dialog-->
</div>
<!-- Add a new subscription modal -->
{% endif %}

{% if not is_worldwide %} {# Just in case #}
<!-- Add a new bottled subscription modal -->
<div class="modal modal-hc modal-form fade new-order"
  id="addNewSubsBottled"
  tabindex="-1"
  data-backdrop="static"
  role="dialog"
  aria-labelledby="Add a new subscription">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <p class="s-h2"><b>{% trans 'Add new subscription' %}</b></p>
      </div>

      <div class="modal-body js-curr-subscription">
        <div class="modal-body-section__sm">

          <form method="POST" action="{% url 'create_order' %}" class="js-create-order">
            {% csrf_token %}
            <div class="form-group">
              <label>{% trans 'Choose a coffee' %}</label>

              <div class="dropdown">
                <button
                  class="btn dropdown-toggle btn-hc btn-hc-xs btn-primary-inv"
                  type="button"
                  id="addsubs-bottled"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="true">
                  <div class="dropdown-item">
                    {% with coffee=coffees_bottled.0 %}
                      <img class="coffee-img" src="{{ coffee.img.url }}" />
                      <span>{{ coffee.name }}</span>
                    {% endwith %}
                  </div>
                  <span class="caret"></span>
                </button>

                <ul class="dropdown-menu">
                  {% for coffee in coffees_bottled %}
                    <li class="coffee-dropdown">
                      <a class="dropdown-item" data-type="coffee" data-object-id="{{ coffee.id }}" href="#">
                        <img class="coffee-img" src="{{ coffee.img.url }}" />
                        <span>{{ coffee.name }}</span>
                      </a>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </div>

            <div class="form-group form-group-slider test_css">
              <div class="col-xs-12">
                <p>Tell us how often youâ€™d like us to deliver your coffee </p>
                  <br>
                <p class='custom_h1'>EVERY:</p>

                <div data-toggle="buttons" class="col-xs-12">
                  <div class="row delivery_days">
                      <div class="col-xs-4">
                        <label id="weekly" data-value="7" class="btn col-xs-offset-1 col-sm-offset-4">
                            <input type="radio" class="hide">
                            <p class='custom_h2'>7</p>
                        </label>

                        <p> days</p>
                      </div>

                      <div class="col-xs-4">
                          <label id="fortnight" data-value="14" class="btn col-xs-offset-1 col-sm-offset-4 active">
                              <input type="radio" class="hide">
                              <p class='custom_h2'>14</p>
                          </label>

                          <p> days</p>
                      </div>

                      <div class="col-xs-4">
                          <label id="monthly" data-value="28" class="btn col-xs-offset-1 col-sm-offset-4">
                              <input type="radio" class="hide">
                              <p class='custom_h2'>28</p>
                          </label>

                          <p> days</p>
                      </div>
                  </div>

                    <br>
                    <p>To help you estimate better, one cup of coffee a day works out to be<br>
                        about 1 bag every 2 weeks</p>
                    <br>

                    <p>Donâ€™t worry! You are not locked into any frequency, you can change it <br>
                      later on or order emergency bags on your account page.</p>
                    <br>

                    <div class="row">
                        <div class="col-xs-12 col-sm-6 col-sm-offset-3 col-xs-offset-0">
                          <label class="btn btn-default btn-hc-sm opt-diff col-xs-12 another_frequency" data-value=false>
                          <input type="radio" class="hide"/>
                            <p>Choose another frequency </p>
                          </label>
                        </div>
                    </div>

                    <div class="row frequency hide">
                        <p class='custom_h1'>EVERY:</p>
                    </div>

                    <div class="row frequency hide">
                        <div class="input-group col-sm-4 col-xs-12 col-xs-offset-0 col-sm-offset-4">
                          <span class="input-group-btn">
                            <button type="button" class="btn btn-default btn-number" data-type="minus" data-field="quant[1]">
                              <span class="glyphicon glyphicon-minus"></span>
                            </button>
                          </span>
                          <input type="text" name="quant[1]" class="form-control input-number" value="25" min="4" max="40" readonly="readonly" />
                          <span class="input-group-btn">
                            <button type="button" class="btn btn-default btn-number" data-type="plus" data-field="quant[1]">
                              <span class="glyphicon glyphicon-plus"></span>
                            </button>
                          </span>
                        </div>
                    </div>

                    <div class="row frequency hide">
                      <p class='custom_h1'>DAYS</p>
                    </div>

                  </div>
                  {% if not coffee.is_discovery_pack %}

                      <div class="col-xs-12" style="padding-top:20px;">
                        <div class="btn-group" data-toggle="buttons">
                          <label id="same" class="btn btn-default btn-hc-sm opt-diff" data-value=false>
                            <input type="radio" /> {% trans 'Same' %}
                          </label>
                          <label id="different" class="btn btn-default btn-hc-sm opt-diff active" data-value=true title="We will send you a random&#013;selection of coffees. However &#013;occasional we might send you the &#013;same thing, so do check back to &#013;change your coffee selection!">
                            <input type="radio" /> {% trans 'Surprise me' %}
                          </label>
                        </div>
                      </div>
                  {% endif %}
                </div>
            </div>

            <div class="form-group">
              <div class="panel panel-form">
                <div class="panel-body">
                  <div class="panel-row">

                    <div class="panel-group"
                      id="addsub-modal-addr-bottled"
                      role="tablist"
                      aria-multiselectable="true">
                      <div class="header col-xs-12">
                        {% trans 'Shipping Address' %}
                        <a role="button"
                          data-toggle="collapse"
                          data-parent="#addsub-modal-addr-bottled"
                          href="#addsub-modal-addr-change-bottled"
                          aria-expanded="true">
                          {% trans 'Change Address' %}
                        </a>
                      </div>

                      {% for form in addresses_forms %}
                        {% if form.is_primary.value %}
                          <p class="selected-addr">
                            <span class="addr-name">
                              {{ form.name.value }}
                            </span>
                            <span class="addr">
                              {{ form.line1.value }} {{ form.line2.value }},
                              <br />
                              {% firstof form.initial.country.name form.instance.country.name %}
                              {{ form.postcode.value }}
                            </span>
                          </p>
                        {% endif %}
                      {% endfor %}
                    </div>

                    <div id="addsub-modal-addr-change-bottled"
                      class="panel-collapse collapse"
                      role="tabpanel">
                      <ul class="address-list js-address-list">

                        {% for form in addresses_forms %}
                          <li data-subid="subs-addr-change"
                            {# data-order-id="{{ order.id }}" #}
                            data-parent-id="addsub-modal-addr-bottled"
                            data-addr-id="{{ form.initial.id }}"
                            {% if form.is_primary.value %}
                              class="selected"
                            {% endif %}
                            >
                            <div>
                              <p><b class="js-addr-name">{{ form.name.value }}</b></p>
                              <p><small class="js-addr-recipient_name">{{ form.recipient_name.value }}</small></p>
                              <p class="js-addr-lines">
                                {{ form.line1.value }} {{ form.line2.value }},
                                <br />
                                {% firstof form.initial.country.name form.instance.country.name %}
                                {{ form.postcode.value }}
                              </p>
                            </div>
                            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                          </li>
                        {% endfor %}

                      </ul>
                    </div>

                  </div>
                </div>
              </div>
            </div>

            <div class="form-group">
              <div class="modal-footer">
                {{ new_order_form_bottled.coffee.as_hidden }}
                {{ new_order_form_bottled.brew.as_hidden }}
                {{ new_order_form_bottled.package.as_hidden }}
                {{ new_order_form_bottled.interval.as_hidden }}
                {{ new_order_form_bottled.different.as_hidden }}
                {{ new_order_form_bottled.address.as_hidden }}
                <button type="submit" class="btn btn-primary btn-hc">{% trans 'Subscribe' %}</button>
              </div>
            </div>

          </form>
        </div>
      </div>

    </div>
    <!--modal-content-->
  </div>
  <!--modal-dialog-->
</div>
<!-- Add a new subscription modal -->
{% endif %}

{% endblock %}

{% block scripts %}

<!-- Isotope integration -->
<script>

var skip = "{{skip}}";

var coffee_rating = {
  {% for coffee in coffee_rating %}
    '{{ coffee.id }}': {{ coffee.avg_rating }},
  {% endfor %}
}

var TOTAL_FRIENDS_INVITED = parseInt({{ customer.get_friends_invited }}),
    TOTAL_INVITE_POINTS_EARNED = parseInt({{ customer.get_invite_points_earned }}),
    TOTAL_REDEEMED_POINTS = parseInt({{ redemed_points }}),
    TOTAL_POINTS_EARNED = parseInt({{ accumulated_points }}),
    TOTAL_POINTS_HAVE = parseInt({{ points }});

window.onload = function() {

  $('[data-toggle="popover"]').popover();

  initialize_sliders();
  update_customer_ref_data();

  {% if show_customer_survey %}
    setTimeout(function() {
      $('#modal-exp-survey').modal('show');
      create_typeform_iframe('#modal-exp-survey .modal-content', 'HD2mS4');
    }, 5 * 1000);
  {% endif %}

  {# if user.is_authenticated and not is_worldwide #}
    // if (getCookie('dashboard-presentation') === "") {
    //   setTimeout(function() {
    //     $('#modal-new-dashboard-presentation').modal();
    //     setCookie('dashboard-presentation', 'true', 365+10);
    //   }, 3 * 1000);
    // }
  {# endif #}

  {% if stripe_notification %}
    alert("{{stripe_notification}}");
  {% endif %}

  {% if messages %}
    localStorage.removeItem("cart");
    $("#btn-checkout-cart").attr('disabled', true);
    $("#menu-cart li").not("#li-checkout-cart").remove();
  {% endif %}

  {% if new_purchase_amount %}
    fbq('track', 'Purchase', {value: '{{ new_purchase_amount }}', currency: 'SGD'});
    twq('track', 'Purchase', {value: '{{ new_purchase_amount }}', currency:'SGD'});
    shopisty.passOrder( 'Coffee');
  {% endif %}

  $(window).on('message', function(e) {
    if (e.originalEvent.data === 'form-submit') {
      if (window.CANCEL_ORDER_ID) {
        unsubscribe(e);
      } else {
        answered_exp_survey(e);
      }
    }
  });

  $('.not-active').click(function (e) {
    e.preventDefault();
  });

  $('.js-sub-pause').click(pause_or_resume_subscription);

  $('.js-order-details').click(function(e) {
    var modal = $('#md-orderdetails'),
        orderReviewModalBtn = modal.find('.js-show-order-review-modal'),
        orderData = $(e.currentTarget).data(),
        orderId = orderData.orderId,
        orderStatus = orderData.orderStatus,
        orderRating = orderData.orderRating,
        orderReview = orderData.orderReview,
        orderBrew = orderData.orderBrew,
        coffeeId = orderData.coffeeId,
        name = orderData.name,
        imageUrl = orderData.image || '',
        price = orderData.price,
        points = orderData.points,
        brew = orderData.brew,
        package = orderData.package,
        isSubscription = orderData.subscription,
        tracking = orderData.tracking || 'N/A',
        shippingDate = orderData.shippingDate,
        shippingAddr = orderData.shippingAddr;
        estimateDelivery = orderData.estimateDelivery;

    modal.find('.js-order-name').text(name);
    modal.find('.js-order-image').css('background-image', 'url("' + imageUrl + '")');
    modal.find('.js-order-brew').text(brew ? brew + ' | ' : '');

    modal.find('.js-order-package').text(package ? package + ' | ' : '');
    modal.find('.js-order-address').html(shippingAddr);
    if (typeof points !== 'undefined') {
      modal.find('.js-order-currency').text('Points');
      modal.find('.js-order-price').text(points);
    } else {
      modal.find('.js-order-currency').text('Price');
      modal.find('.js-order-price').text('S$' + price);
    }
    if (['Shipped', 'Done'].indexOf(orderStatus) !== -1) {
      orderStatus = '{% trans "was dispatched on" %}';
    } else {
      shippingDate = '';
    }
    modal.find('.js-order-type').text(isSubscription ? '(Subscription)' : '(ONE-OFF)');
    modal.find('.js-order-tracking').text(tracking);
    modal.find('.js-order-status').text(orderStatus);
    modal.find('.js-order-shipping-date').text(shippingDate);
    modal.find('.js-estimate-delivery').text(estimateDelivery);

    var $coffeeAvgStarsBlock = modal.find('.js-coffee-avg-rating');
    var coffeeAvgRating = Math.round(coffee_rating[coffeeId]);
    if (!isNaN(coffeeAvgRating)) {
      $coffeeAvgStarsBlock
        .empty()
        .append('<span class="glyphicon glyphicon-star text-primary"></span>'.repeat(coffeeAvgRating))
        .show();
    } else {
      $coffeeAvgStarsBlock.hide();
    }

    if (typeof coffeeId === 'undefined') {
      orderReviewModalBtn.hide();
    } else {
      orderReviewModalBtn
        .show()
        .data('orderId', orderId)
        .data('coffeeId', coffeeId)
        .data('orderRating', orderRating)
        .data('orderReview', orderReview)
        .data('coffeeName', name)
        .data('orderBrew', orderBrew);
    }
  });

  $('.js-typeform').click(function(e) {
    var order = $(this).data('orderId');
    if (order) {
      window.CANCEL_ORDER_ID = order;
      create_typeform_iframe('#modal-unsubscribe-survey .modal-content', 'RNSQTm');
    }
    $(this).closest('.modal').modal('hide');
  });

  $('.modal-survey').on('click', '.typeform-button', function(e) {
    $modal = $(this).closest('.modal');
    if ($modal.attr('id') === 'modal-unsubscribe-survey') {
      window.UNSUBSCRIBE_SURVEY_IS_ACTIVE = true;
    }
    $modal.modal('hide');
  });

  $('#modal-unsubscribe-survey').on('hide.bs.modal', function(e) {
    if (!window.UNSUBSCRIBE_SURVEY_IS_ACTIVE && window.CANCEL_ORDER_ID) {
      // user trying to close the survey before submit
      $('#modal-unsubscribe-survey-warning').modal('show');
    }
  });

  $(document).on('click', '.typeform-modal-RNSQTm .typeform-close', function(e) {
    if (window.CANCEL_ORDER_ID) {
      // user trying to close the survey before submit
      $('#modal-unsubscribe-survey-warning').modal('show');
    }
  });

  $('.js-cancel-one-off').click(function(e) {
    var data = e.currentTarget.dataset,
        orderID = data.order,
        isGear = (data.isgear === 'true'),
        $submitBtn = $(e.currentTarget);

    $submitBtn.prop('disabled', true);

    $.ajax({
      url: "{% url 'cancel_one_order' %}",
      type: "POST",
      data: {
        order: orderID,
        gearorder: isGear ? orderID : null,
        isGear: isGear,
        csrfmiddlewaretoken: "{{ csrf_token }}",
      },
      success: function(data) {
        $('tr#order-' + orderID).attr('hidden', 'hidden');

        $.notify({
          message: "{% trans 'Your order cancelled successfully.' %}"
        }, {
          type: 'success'
        });
      },
      error: function(error) {
        $.notify({
          message: "{% trans 'Sorry there was an error trying to cancel your order. Please try again later.' %}"
        }, {
          type: 'danger'
        });
      },
    });
  });

  var width = $(window).width();
  function update_table_responsive(width) {
    var tb = $('.js-tb-responsive')
    if (width <= 500) {
      tb.addClass('table-responsive');
    } else {
      tb.removeClass('table-responsive');
    }
  }
  $(window).resize(function(){
     if ($(this).width() != width) {
        width = $(this).width();
     }
     update_table_responsive(width);
  });

  update_table_responsive(width);

  var nothing_share = !$('button').is('.js-fb-share');
  if (nothing_share) {
    $('.js-tb-share th:last-child').hide();
  }
};


function pause_or_resume_subscription(e) {
  e.preventDefault();
  var action = $(e.currentTarget).data('action')
      orderID = $(e.currentTarget).data('orderId'),
      $modal = $(e.currentTarget).closest('.modal'),
      $subscription = $('.js-sub-' + orderID),
      $subBtns = $subscription.find('.js-sub-btn'),
      $pauseBtn = $subscription.find('.js-sub-pause'),
      pauseBtnDefText = $pauseBtn.text(),
      shippingDate = moment($subscription.data('shippingDate'), 'DD/MM/YYYY');

  if (action === 'pause') {
    $pauseBtn.html('<i class="fa fa-refresh fa-spin"></i>  {% trans "Pausing" %}');
  } else if (action === 'resume') {
    $pauseBtn.html('<i class="fa fa-refresh fa-spin"></i>  {% trans "Resuming" %}');
  }

  $.ajax({
    url: "{% url 'pause_resume_order' %}",
    type: 'POST',
    data: {
      order: orderID,
      csrfmiddlewaretoken: "{{ csrf_token }}",
    },
    success: function(data) {
      if (action === 'pause') {
        $subscription.find('.resumed-div').addClass('hide');
        var reverseAction = 'resume',
            btnText = "{% trans 'Resume' %}",
            event = 'paused-subscription',
            message = "{% trans 'Your subscription has been paused for a month and will automatically resume on' %} " + data.new_date;
        Intercom('update', {'paused': true});
      } else if (action === 'resume') {
        $subscription.find('.resumed-div').removeClass('hide');
        var reverseAction = 'pause',
            btnText = "{% trans 'Pause subscription for 30 days' %}",
            event = 'resumed-subscription',
            message = "{% trans 'Your subscription is now resumed.' %}";
        Intercom('update', {'paused': false});
      }

      $subBtns.prop('disabled', true);
      $pauseBtn
        .data('action', reverseAction)
        .prop('disabled', false)
        .html(btnText);
      $subscription
        .find('.js-sched-details-date')
        .text(moment(data.new_date, 'DD of MMMM, YYYY').format('MMMM, D (dddd)'));

      Intercom('trackEvent', event, {
        'order': orderID,
        'old_date': shippingDate.unix(),
        'new_date': moment(data.new_date, 'DD of MMMM, YYYY').unix(),
      });

      $.notify({
        message: message
      }, {
        type: 'success'
      });
    },
    error: function(error) {
      $subBtns.prop('disabled', false);
      $pauseBtn.html(pauseBtnDefText);
      $.notify({
        message: "{% trans 'Sorry there was an error trying to update your subscription. Please try again later.' %}"
      }, {
        type: 'danger'
      });
    },
    complete: function(jqXHR, status) {
      if ($modal.length > 0) {
        $modal.modal('hide');
      }
    },
  });
}


function create_typeform_iframe(selector, formId) {
  if ($(selector).has('iframe').length > 0) {
    return
  }
  var iframe = document.createElement('iframe');
  iframe.id = 'typeform-full';
  iframe.style.width = '100%';
  iframe.style.height = '100%';
  iframe.style.border = '0';
  iframe.src = 'https://projectbravo.typeform.com/to/' + formId +'?name={{ customer.first_name }}&email={{ customer.get_lower_email }}';
  $(selector).append(iframe);
}

function unsubscribe(e) {
  var order = window.CANCEL_ORDER_ID,
      $subscription = $('.js-sub-' + order),
      $currentTab = $subscription.closest('.tab-pane'),
      $noSubscriptions = $currentTab.find('.js-no-subscription');

  window.CANCEL_ORDER_ID = null;
  window.UNSUBSCRIBE_SURVEY_IS_ACTIVE = false;

  $.ajax({
    url: "{% url 'cancel_one_order' %}",
    type: 'POST',
    data: {
      order: order,
      csrfmiddlewaretoken: '{{ csrf_token }}',
    },
    success: function() {
      $subscription.addClass('hide');

      var $addNewSubBtn = $currentTab.find('.js-add-new-sub-btn'),
          $otherSubscriptions = $currentTab
                                  .find('.js-curr-subscription')
                                  .not('.hide');
      if ($otherSubscriptions.length === 0) {
        $addNewSubBtn.addClass('hide');
        $noSubscriptions.removeClass('hide');
      }

      $.notify({
        message: "{% trans 'Unsubscribe successful.' %}"
      }, {
        type: 'success'
      });
    },
    error: function(error) {
      $.notify({
        message: "{% trans 'Sorry there was an error trying to update your subscription. Please try again later.' %}"
      }, {
        type: 'danger'
      });
    },
  });
}

function answered_exp_survey(e) {
  $.ajax({
    url: "{% url 'answered_exp_survey' %}",
    type: 'POST',
    data: {
      csrfmiddlewaretoken: '{{ csrf_token }}',
    },
    success: function() {},
    error: function(error) {
      $.notify({
        message: "{% trans 'Sorry there was an error trying to update your subscription. Please try again later.' %}"
      }, {
        type: 'danger'
      });
    },
  });
}

function initialize_sliders() {
  var ordersBags = [
        {% for order in orders %} {id: {{ order.id }}, interval: {{ order.interval }}, package: '{{ order.package }}', isPods: false }, {% endfor %}
      ],
      ordersPods = [
        {% for order in orders_pods %} {id: {{ order.id }}, interval: {{ order.interval }}, package: '{{ order.package }}', isPods: true }, {% endfor %}
      ],
      orders = ordersBags.concat(ordersPods);

  // Change shipping interval, part for fixed button
  $(document).on('click', '.test_css .delivery_days label', function(e){
    $('.test_css .delivery_days label').removeClass('active');
    $('.another_frequency').removeClass('active');
    $('.row.frequency').addClass('hide');
    $(this).addClass('active');
    interval_days = $(this).data('value');
    $('.another_frequency').css('background-color', '#fff');
    // current modal have hidden! input before send button, so we need change it before
    $('.modal[style *="display: block;"]').find('.modal-footer #id_interval').val(interval_days);
  });

  // show and hide custom frequency part
  $(document).on('click', '.another_frequency', function(e){
      $(this).removeClass('selected');
      $(this).addClass('active');
      $(this).css('background-color', '#ffcc00');
      $('.row.frequency').removeClass('hide');
      var interval_days = $('.modal[style *="display: block;"]').find('.frequency input.input-number').val();
      $('.modal[style *="display: block;"]').find('.modal-footer #id_interval').val(interval_days);
  });

    // + - frequency button
    $('.frequency .btn-number').click(function(e){
      e.preventDefault();

      fieldName = $(this).attr('data-field');
      type      = $(this).attr('data-type');
      var input = $("input[name='"+fieldName+"']");
      var currentVal = parseInt(input.val());

      if (!isNaN(currentVal)) {
          if(type == 'minus') {

              if(currentVal > input.attr('min')) {
                  $('.frequency input').val(currentVal - 1).change();
              }
              if(parseInt(input.val()) == input.attr('min')) {
                  $(this).attr('disabled', true);
              }

          } else if(type == 'plus') {

              if(currentVal < input.attr('max')) {

                  $('.frequency input').val(currentVal + 1).change();
              }
              if(parseInt(input.val()) == input.attr('max')) {
                  $(this).attr('disabled', true);
              }

          }
      } else {
          input.val(0);
      }
    });
    $('.frequency .input-number').focusin(function(){
       $(this).data('oldValue', $(this).val());
    });
    $('.frequency .input-number').change(function() {

        minValue =  parseInt($(this).attr('min'));
        maxValue =  parseInt($(this).attr('max'));
        valueCurrent = parseInt($(this).val());

        name = $(this).attr('name');
        if(valueCurrent >= minValue) {
            $(".frequency .btn-number[data-type='minus'][data-field='"+name+"']").removeAttr('disabled')
        } else {
            alert('Sorry, the minimum value was reached');
            $(this).val(minValue);
        }
        if(valueCurrent <= maxValue) {
            $(".frequency .btn-number[data-type='plus'][data-field='"+name+"']").removeAttr('disabled')
        } else {
            alert('Sorry, the maximum value was reached');
            $(this).val(maxValue);
        }
        // current modal have hidden! input before send button, so we need change it before
        $('.modal[style *="display: block;"]').find('.modal-footer #id_interval').val(valueCurrent);
    });
}

// Collapse preferences -> subscription items
$('.js-coffee-panel').on('show.bs.collapse', function () {
  $(this).addClass('active');
});

$('.js-coffee-panel').on('hide.bs.collapse', function () {
  $(this).removeClass('active');
});

// Collapse preferences -> account
$('#acct-addr').on('show.bs.collapse', function () {
  $(this).find('.trans-toggle').addClass('hidden');
});
$('#acct-addr').on('hide.bs.collapse', function () {
  $(this).find('.trans-toggle').removeClass('hidden');
});

$('#acct-addr-change-cancel').on('click', function () {
  $('#acct-addr-change').collapse('hide');
});

$('#acct-addr-change-edit').on('click', function () {
  var changeAddr = $('.selected[data-subid="acct-addr-change"]'),
      addrID = changeAddr.data('addrId');
  console.log('addrID:', addrID, $('.js-acct-addr-edit[data-addr="' + addrID + '"]'));
  $('#acct-addr-change').collapse('hide');
  $('.js-acct-addr-edit[data-addr="' + addrID + '"]').collapse('show');
});

$('#acct-addr-add-cancel').on('click', function () {
  $('#acct-addr-add').collapse('hide');
});
$('#acct-addr-add-save').on('click', function () {
  $('#acct-addr-add').collapse('hide');
});

$(document).on('click', '.js-acct-addr-edit-cancel', function () {
  $('#acct-addr-change').collapse('show');
  $('#acct-addr').find('.trans-toggle').addClass('hidden');
});

$('.js-subs-addr-change-cancel').on('click', function () {
  $(this).closest('.js-subs-addr-change').collapse('hide');
});

$('#pods-addr-change-cancel').on('click', function () {
  $('#pods-addr-change').collapse('hide');
});
$('#pods-addr-change-save').on('click', function () {
  $('#pods-addr-change').collapse('hide');
});

// Preferences -> select shipping address
$('.js-address-list').on('click', 'li', function () {
  var subid = $(this).data('subid');
  var parentId = $(this).data('parentId');
  var addrName = $(this).find('.js-addr-name').text();  // $(this).data('addrName');
  var addr = $(this).find('.js-addr-lines').text(); // $(this).data('addr');

  $('.js-address-list li[data-subid="' + subid + '"]').removeClass('selected');
  $(this).addClass('selected');

  $("#" + parentId + " .selected-addr .addr-name").text(addrName);
  $("#" + parentId + " .selected-addr .addr").text(addr);
});

// Order review -> star review
$('.form-star-review i.fa').mouseenter(function () {
  $this = $(this);
  $this.siblings().andSelf().removeClass('clr-me-p');
  $this.nextAll().removeClass('clr-me-p').switchClass('fa-star', 'fa-star-o');
  $this.prevAll().andSelf().addClass('clr-me-p').switchClass('fa-star-o', 'fa-star');
});

// Notification toggle
$('#notif-wrapper .notif-header').click(function () {
  $('#notif-wrapper').toggleClass('open');
});

// Modal dropdown -> change selected item on click
$('.dropdown-menu li a').click(function (){
  var $form = $(this).closest('form'),
      src = $(this).find('img').attr('src'),
      name = $(this).find('span').text(),
      type = $(this).data('type'), // coffee or brew
      selectedID = $(this).data('objectId'),
      $btn = $(this).closest('.dropdown').find('.btn .dropdown-item');
  $btn.find('img').attr('src', src);
  $btn.find('span').text(name);
  $form.find('[name="' + type +'"]').val(selectedID);
});

</script>
<script src="https://cdn.jsdelivr.net/rangeslider.js/2.3.0/rangeslider.min.js"></script>
<script src="{% static 'moment/min/moment.min.js' %}"></script>
<script src="{% static 'eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js' %}"></script>
<script src="{% static 'remarkable-bootstrap-notify/bootstrap-notify.min.js' %}"></script>
<script src="https://apis.google.com/js/client.js"></script>

{% compress js %}
  <script src="{% static 'assets/custom/js/fb.js' %}"></script>
  <script src="{% static 'assets/custom/js/referral.js' %}"></script>
  <script src="{% static 'assets/custom/js/profile.js' %}"></script>
  <script src="{% static 'assets/custom/js/notify-defaults.js' %}"></script>
  <script src="{% static 'assets/custom/js/user-dashboard.js' %}"></script>
{% endcompress %}

<script type="text/javascript">if(typeof wabtn4fg==="undefined"){wabtn4fg=1;h=document.head||document.getElementsByTagName("head")[0],s=document.createElement("script");s.type="text/javascript";s.src="{% static 'assets/custom/js/whatsapp-button.js' %}";h.appendChild(s);}</script>

<script type="text/javascript" src="https://embed.typeform.com/embed.js"></script>

{% endblock %}
